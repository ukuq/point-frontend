(function(t){function a(a){for(var n,s,r=a[0],l=a[1],c=a[2],d=0,p=[];d<r.length;d++)s=r[d],Object.prototype.hasOwnProperty.call(o,s)&&o[s]&&p.push(o[s][0]),o[s]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(t[n]=l[n]);u&&u(a);while(p.length)p.shift()();return i.push.apply(i,c||[]),e()}function e(){for(var t,a=0;a<i.length;a++){for(var e=i[a],n=!0,r=1;r<e.length;r++){var l=e[r];0!==o[l]&&(n=!1)}n&&(i.splice(a--,1),t=s(s.s=e[0]))}return t}var n={},o={app:0},i=[];function s(a){if(n[a])return n[a].exports;var e=n[a]={i:a,l:!1,exports:{}};return t[a].call(e.exports,e,e.exports,s),e.l=!0,e.exports}s.m=t,s.c=n,s.d=function(t,a,e){s.o(t,a)||Object.defineProperty(t,a,{enumerable:!0,get:e})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,a){if(1&a&&(t=s(t)),8&a)return t;if(4&a&&"object"===typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(s.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&a&&"string"!=typeof t)for(var n in t)s.d(e,n,function(a){return t[a]}.bind(null,n));return e},s.n=function(t){var a=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(a,"a",a),a},s.o=function(t,a){return Object.prototype.hasOwnProperty.call(t,a)},s.p="/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],l=r.push.bind(r);r.push=a,r=r.slice();for(var c=0;c<r.length;c++)a(r[c]);var u=l;i.push([0,"chunk-vendors"]),e()})({0:function(t,a,e){t.exports=e("56d7")},"00cb":function(t,a,e){},"034f":function(t,a,e){"use strict";var n=e("296e"),o=e.n(n);o.a},"296e":function(t,a,e){},"29a4":function(t,a,e){"use strict";var n=e("00cb"),o=e.n(n);o.a},"56d7":function(t,a,e){"use strict";e.r(a);e("e260"),e("e6cf"),e("cca6"),e("a79d");var n=e("2b0e"),o=e("5f5b"),i=e("b1e0"),s=(e("f9e3"),e("2dd8"),function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{attrs:{id:"app"}},[e("b-navbar",{attrs:{toggleable:"lg",type:"dark",variant:"dark",sticky:""}},[e("div",{staticClass:"container"},[e("b-navbar-brand",{attrs:{href:"#"}},[e("img",{staticClass:"d-inline-block align-top",attrs:{src:"https://cdn.onesrc.cn/uploads/images/onepoint_30.png",alt:"logo"}}),t._v(" ONEPOINT ")]),e("b-collapse",{attrs:{id:"nav-collapse","is-nav":""}},[e("b-navbar-nav",[e("li",{staticClass:"nav-item"},[e("router-link",{staticClass:"nav-link",attrs:{to:"/home"}},[t._v("Home")])],1),t.$store.state.isadmin?[e("li",{staticClass:"nav-item"},[e("router-link",{staticClass:"nav-link",attrs:{to:"/files"}},[t._v("Files")])],1),e("li",{staticClass:"nav-item"},[e("router-link",{staticClass:"nav-link",attrs:{to:"/setting"}},[t._v("Setting")])],1),e("li",{staticClass:"nav-item"},[e("router-link",{staticClass:"nav-link",attrs:{to:"/cache"}},[t._v("Cache")])],1),e("li",{staticClass:"nav-item"},[e("router-link",{staticClass:"nav-link",attrs:{to:"/dashboard"}},[t._v("Dashboard")])],1)]:t._e()],2),e("b-navbar-nav",{staticClass:"ml-auto"},[t.$store.state.isadmin?e("b-nav-item",{attrs:{href:"logout",right:""},on:{click:function(a){return a.preventDefault(),t.logout(a)}}},[t._v("Logout")]):e("li",{staticClass:"nav-item"},[e("router-link",{staticClass:"nav-link",attrs:{to:"/login"}},[t._v("Login")])],1)],1)],1)],1)]),e("router-view"),t._m(0)],1)}),r=[function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("p",{staticClass:"text-muted text-center m-3"},[t._v(" Designed by "),e("a",{attrs:{href:"https://www.onesrc.cn/"}},[t._v("ONESRC")]),t._v(" | Powered by "),e("a",{attrs:{href:"https://github.com/ukuq/onepoint"}},[t._v("OnePoint")]),t._v(". ")])}],l={methods:{logout:function(){this.$store.commit("logoutSuccess"),this.common.axios.get("./admin/logout").catch((function(){})),this.$router.push({path:"/login"})}}},c=l,u=(e("034f"),e("2877")),d=Object(u["a"])(c,s,r,!1,null,null,null),p=d.exports,m=e("8c4f"),h=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"container mt-3"},[e("b-breadcrumb",[e("b-breadcrumb-item",{on:{click:function(a){return t.chwd("/")}}},[e("b-icon",{attrs:{icon:"house-fill",scale:"1.25","shift-v":"1.25","aria-hidden":"true"}}),t._v("Home ")],1),t._l(t.navPathArr,(function(a){return e("b-breadcrumb-item",{key:a.href,attrs:{href:a.href},on:{click:function(e){return e.preventDefault(),t.chwd(a.href)}}},[t._v(t._s(a.path))])}))],2),e("div",{staticClass:"mt-3"},[t.audioList.length>0?e("aplayer",{attrs:{list:t.audioList,music:t.aplayerData.music,repeat:t.aplayerData.repeat,shuffle:t.aplayerData.shuffle},on:{"update:music":function(a){return t.$set(t.aplayerData,"music",a)},"update:repeat":function(a){return t.$set(t.aplayerData,"repeat",a)},"update:shuffle":function(a){return t.$set(t.aplayerData,"shuffle",a)}}}):t._e()],1),e("b-table",{staticClass:"border rounded mt-2",attrs:{hover:"",responsive:"",items:t.list,fields:t.fields,"primary-key":"nameFormat","head-variant":"light","per-page":t.pageData.perPage,"current-page":t.pageData.currentPage},scopedSlots:t._u([{key:"cell(nameFormat)",fn:function(a){return[1===a.item.type?[e("b-icon",{attrs:{icon:"folder",scale:"1.25","shift-h":"-3","aria-hidden":"true"}}),e("a",{attrs:{href:a.item.name+"/"},on:{click:function(e){return e.preventDefault(),t.chwd(a.item.name+"/")}}},[t._v(t._s(a.item.name)+"/")])]:3===a.item.type?[e("b-icon",{attrs:{icon:"inbox",scale:"1.25","shift-h":"-3","aria-hidden":"true"}}),e("a",{attrs:{href:a.item.name+"/"},on:{click:function(e){return e.preventDefault(),t.chwd(a.item.name+"/")}}},[t._v(t._s(a.item.name)+"/")])]:[e("b-icon",{attrs:{icon:"document",scale:"1.25","shift-h":"-3","aria-hidden":"true"}}),e("a",{staticClass:"mr-2",attrs:{href:a.item.name+"?preview"},on:{click:function(e){return e.preventDefault(),t.preview(a.item)}}},[t._v(t._s(a.item.name))]),e("a",{attrs:{href:t.common.p_h0+t.nowPath+a.item.name,target:"_blank"}},[e("b-icon",{attrs:{icon:"download",scale:"1.25","shift-h":"-3","aria-hidden":"true"}})],1)]]}},{key:"table-busy",fn:function(){return[e("div",{staticClass:"text-center text-primary my-2"},[e("b-spinner",{staticClass:"align-middle"}),e("strong",[t._v(t._s(t.loadingData.info))])],1)]},proxy:!0}])}),e("div",{staticClass:"overflow-auto",staticStyle:{display:"flex","justify-content":"flex-end"}},[e("b-pagination",{attrs:{"total-rows":t.list.length,"per-page":t.pageData.perPage},model:{value:t.pageData.currentPage,callback:function(a){t.$set(t.pageData,"currentPage",a)},expression:"pageData.currentPage"}}),e("b-form-select",{staticClass:"mb-3 ml-2",staticStyle:{width:"100px"},attrs:{options:t.pageData.pageOptions},model:{value:t.pageData.perPage,callback:function(a){t.$set(t.pageData,"perPage",a)},expression:"pageData.perPage"}}),t.next?e("b-button",{staticClass:"ml-2 mb-3",on:{click:function(a){return t.updateList(t.nowPath,t.next)}}},[t._v(t._s(t.loadingData.isBusy?"loading...":"LoadMore"))]):t._e()],1),e("b-modal",{attrs:{centered:"","hide-footer":"",title:"title",size:"xl"},model:{value:t.dplayerData.isBusy,callback:function(a){t.$set(t.dplayerData,"isBusy",a)},expression:"dplayerData.isBusy"}},[e("video-player",{ref:"videoPlayer",attrs:{url:t.dplayerData.url,path:t.dplayerData.path}})],1)],1)},f=[],v=(e("4160"),e("fb6a"),e("b0c0"),e("ac1f"),e("1276"),e("2ca0"),e("159b"),function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{attrs:{id:"dplayer"}})}),g=[],b=(e("96cf"),e("1da1")),w=(e("eccb"),e("f7a5")),y=e.n(w),D={name:"VideoPlayer",data:function(){return{options:{container:null,video:{url:""},subtitle:null,autoplay:!1},player:null}},props:{url:String,path:String},mounted:function(){var t=this;return Object(b["a"])(regeneratorRuntime.mark((function a(){var e,n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.options.container=document.getElementById("dplayer"),e=t.path+".vtt",n=t.url?t.url:t.common.p_h0+t.path,a.next=5,t.common.axios.get(".".concat(t.common.urlSpCharEncode(e),"?json")).then((function(a){a.data&&(t.options.subtitle={url:a.data.downloadUrl,type:"webvtt",fontSize:"25px",bottom:"10%",color:"#b7daff"})})).catch((function(){}));case 5:t.player=new y.a(t.options),t.player.switchVideo({url:n});case 7:case"end":return a.stop()}}),a)})))()},destroyed:function(){this.player.destroy()},watch:{url:function(t){this.player.switchVideo({url:t})}}},k=D,_=(e("29a4"),Object(u["a"])(k,v,g,!1,null,null,null)),C=_.exports,x=e("0f7d"),P=e.n(x),S={components:{VideoPlayer:C,aplayer:P.a},data:function(){return{aplayerData:{music:{src:"https://google.com/404"},repeat:"no-repeat",shuffle:!1},dplayerData:{isBusy:!1,url:"",path:""},nowPath:"/",listCache:{},pageData:{currentPage:1,perPage:10,pageOptions:[{text:"10/Page",value:10},{text:"50/Page",value:50}]},loadingData:{isBusy:!1,info:"default info"},fields:[{key:"nameFormat",label:"Name"},{key:"time",label:"Time",thStyle:"width:180px",formatter:this.common.formatDate},{key:"size",label:"Size",thStyle:"width:120px",class:"text-right mr-3",formatter:this.common.formatSize}]}},created:function(){this.nowPath=this.$route.params.pathMatch||"/",this.updateList(this.nowPath)},methods:{chwd:function(t){t.startsWith("/")?this.updateList(t):this.updateList(this.nowPath+t)},updateList:function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(this.nowPath===t||(this.$router.push({path:"/home"+t}),this.nowPath=t,!this.listCache[t])){if(this.loadingData.isBusy)return this.$message("Processing other tasks, try again later","i");this.loadingData.isBusy=!0,this.loadingData.info="loading... "+t+a,console.log("try: ls "+t+a);var e=this,n=".".concat(this.common.urlSpCharEncode(t),"?json")+(a?"&"+a.slice(1):"");this.common.axios.get(n).then((function(n){e.loadingData.isBusy=!1,n.data.list?a?(n.data.list.forEach((function(a){return e.listCache[t].list.push(a)})),e.listCache[t].next=n.data.next):e.$set(e.listCache,t,n.data):console.log(n.data)})).catch((function(t){e.loadingData.isBusy=!1,console.log(t);var a=t.response?"error: "+t.response.data.info:"error: "+t.message;if(e.$message(a,"d"),401===t.response.status){var o=t.response.data.info.split(":");e.$prompt({message:o[1],ok:function(t){var a={};a[o[0]]=t,e.common.axios.post(n,a).then((function(){e.$message("验证正确","i")})).catch((function(t){console.log(t);var a=t.response?"error: "+t.response.data.info:"error: "+t.message;e.$message(a,"d")}))}})}}))}},preview:function(t){if(t.mime.startsWith("audio"))return this.$message("音乐播放面板它不香么?","i");t.mime.startsWith("video")?(this.dplayerData.url=null,this.dplayerData.path=this.nowPath+t.name,this.dplayerData.isBusy=!0):window.open(this.common.p_h0+this.nowPath+t.name+"?preview","_blank")}},computed:{navPathArr:function(){var t=this.nowPath,a="/",e=[];return t.split("/").forEach((function(t){t&&(a+=t,a+="/",e.push({path:t,href:a}))})),e},list:function(){var t=this.listCache[this.nowPath]||{list:[{type:3,name:this.loadingData.isBusy?"loading...":"loading failed",size:NaN,time:void 0,mime:""}]};return t.list},next:function(){var t=this.listCache[this.nowPath];return t&&(t=t.next),t},audioList:function(){var t=this,a=[];return this.list.forEach((function(e){e.mime.startsWith("audio")&&a.push({title:e.name,src:t.common.p_h0+t.nowPath+e.name})})),a}}},T=S,$=Object(u["a"])(T,h,f,!1,null,null,null),N=$.exports,O=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"container"},[e("div",{staticClass:"row justify-content-center mt-3"},[e("b-card",{staticClass:"col-md-5 p-0 mt-3",attrs:{header:"Login"}},[e("b-form-group",{attrs:{label:"UserName"}},[e("b-form-input",{attrs:{trim:""},model:{value:t.loginForm.username,callback:function(a){t.$set(t.loginForm,"username",a)},expression:"loginForm.username"}})],1),e("b-form-group",{attrs:{label:"Password"}},[e("b-form-input",{attrs:{trim:""},model:{value:t.loginForm.password,callback:function(a){t.$set(t.loginForm,"password",a)},expression:"loginForm.password"}})],1),e("b-button",{attrs:{variant:"primary"},on:{click:t.submit}},[t._v("登录")])],1)],1)])},B=[],j={computed:{},data:function(){return{loginForm:{username:"",password:""}}},methods:{submit:function(){var t=this;this.common.axios.post("./admin/ajax/login",this.loginForm).then((function(){t.$message("登录成功","i"),t.$store.commit("loginSuccess"),t.$router.push({path:"/dashboard"})})).catch((function(a){a.response?t.$message(a.response.data.info,"d"):t.$message(a.message,"d")}))}}},F=j,z=Object(u["a"])(F,O,B,!1,null,null,null),E=z.exports,I=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"container"},[e("b-card",{staticClass:"mt-3",attrs:{"no-body":""}},[e("b-card-header",[t._v("Dashboard")]),e("b-card-body",{staticClass:"row"},[e("div",{staticClass:"col-6",staticStyle:{display:"flex","justify-content":"center","flex-direction":"column","align-items":"center"}},[e("b-card-title",[t._v("createTime:"+t._s(t.getCTime))]),e("b-card-title",[t._v("initTime:"+t._s(t.getITime))])],1),e("div",{staticClass:"col-6"},[e("b-list-group",[e("b-list-group-item",{staticClass:"d-flex justify-content-between align-items-center"},[t._v(" normal "),e("b-badge",{attrs:{variant:"primary",pill:""}},[t._v(t._s(t.runInfo.normal))])],1),e("b-list-group-item",{staticClass:"d-flex justify-content-between align-items-center"},[t._v(" api "),e("b-badge",{attrs:{variant:"primary",pill:""}},[t._v(t._s(t.runInfo.api))])],1),e("b-list-group-item",{staticClass:"d-flex justify-content-between align-items-center"},[t._v(" admin "),e("b-badge",{attrs:{variant:"primary",pill:""}},[t._v(t._s(t.runInfo.admin))])],1)],1)],1)])],1),e("b-card",{staticClass:"mt-3",attrs:{"no-body":""}},[e("b-card-header",[t._v("DriveInfo")]),e("b-card-body",{staticClass:"p-0"},[e("b-table-simple",{attrs:{hover:"",outlined:"",responsive:""}},[e("b-thead",[e("b-tr",[e("b-th",[t._v("path")]),e("b-th",[t._v("funcName")]),e("b-th",[t._v("password")])],1)],1),e("b-tbody",t._l(t.drivesInfos,(function(a){return e("b-tr",{key:a.path},[e("b-td",[t._v(t._s(a.path))]),e("b-td",[t._v(t._s(a.funcName))]),e("b-td",[a.password?[t._v(" "+t._s(a.password)+" "),e("b-dropdown",{attrs:{size:"lg",variant:"link","toggle-class":"p-0","no-caret":""},scopedSlots:t._u([{key:"button-content",fn:function(){return[e("b-icon",{attrs:{icon:"reply","aria-hidden":"true"}}),e("span",{staticClass:"sr-only"},[t._v("Share")])]},proxy:!0}],null,!0)},[e("b-dropdown-text",[t._v("Share it")]),e("b-dropdown-divider"),e("b-dropdown-item",{on:{click:function(e){return t.getShareUrl(a.path,36e5,a.password)}}},[t._v("1小时")]),e("b-dropdown-item",{on:{click:function(e){return t.getShareUrl(a.path,864e5,a.password)}}},[t._v("1天")]),e("b-dropdown-item",{on:{click:function(e){return t.getShareUrl(a.path,6048e5,a.password)}}},[t._v("1星期")])],1)]:e("span",[t._v("none")])],2)],1)})),1)],1),e("p",{staticClass:"text-center"},[e("a",{attrs:{href:t.info}},[t._v(t._s(t.info))])])],1)],1)],1)},M=[],L={name:"Dashboard",data:function(){return{runInfo:{},drivesInfos:[],info:"#Share the drives with your friends"}},created:function(){var t=this;this.common.axios.get("./admin/ajax/dashboard").then((function(a){console.log(a.data),t.runInfo=a.data.runInfo,t.drivesInfos=a.data.drivesInfos}))},methods:{getShareUrl:function(t,a,e){a=(new Date).valueOf()+a;var n=this.common.md5(e+""+a);console.log(e+", "+a+", "+n),this.info=this.common.axios.defaults.baseURL+t.slice(1)+"?token="+n+"&expiresdate="+a}},computed:{getCTime:function(){return this.common.formatDate(this.runInfo.createTime)},getITime:function(){return this.common.formatDate(this.runInfo.initTime)}},components:{}},U=L,A=Object(u["a"])(U,I,M,!1,null,null,null),V=A.exports,R=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"container mt-3"},[e("b-breadcrumb",[e("b-breadcrumb-item",{on:{click:function(a){return t.chwd("/")}}},[e("b-icon",{attrs:{icon:"house-fill",scale:"1.25","shift-v":"1.25","aria-hidden":"true"}}),t._v("Home ")],1),t._l(t.navPathArr,(function(a){return e("b-breadcrumb-item",{key:a.href,on:{click:function(e){return t.chwd(a.href)}}},[t._v(t._s(a.path))])}))],2),e("div",{staticClass:"mt-3"},[e("b-dropdown",{attrs:{text:"Options",variant:"outline-primary"}},[e("b-dropdown-item",{directives:[{name:"b-modal",rawName:"v-b-modal.modal-touch",modifiers:{"modal-touch":!0}}]},[t._v("New File")]),e("b-dropdown-item",{on:{click:function(a){return t.optBtnClick("mkdir")}}},[t._v("New Folder")]),e("b-dropdown-divider"),e("b-dropdown-item",{on:{click:function(a){return t.uploadBtnClick("upload-files")}}},[t._v("Upload File")]),e("b-dropdown-item",{on:{click:function(a){return t.uploadBtnClick("upload-folder")}}},[t._v("Upload Folder")])],1),e("b-button",{staticClass:"ml-2",on:{click:function(a){return t.updateList()}}},[t._v("Sync")]),e("b-button",{directives:[{name:"show",rawName:"v-show",value:t.nextToken,expression:"nextToken"}],staticClass:"ml-2",on:{click:function(a){return t.updateList(t.nowPath,t.nextToken)}}},[t._v("LoadNext")]),e("b-button",{directives:[{name:"show",rawName:"v-show",value:t.uploadData.uploadNow||t.uploadData.uploadQueue.length||t.uploadData.uploadSucess.length||t.uploadData.uploadFail.length,expression:"uploadData.uploadNow || uploadData.uploadQueue.length || uploadData.uploadSucess.length || uploadData.uploadFail.length"},{name:"b-modal",rawName:"v-b-modal.modal-upload",modifiers:{"modal-upload":!0}}],staticClass:"ml-2"},[t._v("Upload Status")]),e("b-button",{directives:[{name:"show",rawName:"v-show",value:"mv"===t.cmdType&&t.srcPath,expression:"('mv' === cmdType) && srcPath"}],staticClass:"ml-2",attrs:{variant:"primary",title:t.srcPath},on:{click:function(a){return t.optBtnClick("mv")}}},[t._v("Move")]),e("b-button",{directives:[{name:"show",rawName:"v-show",value:"cp"===t.cmdType&&t.srcPath,expression:"('cp' === cmdType) && srcPath"}],staticClass:"ml-2",attrs:{variant:"primary",title:t.srcPath},on:{click:function(a){return t.optBtnClick("cp")}}},[t._v("Copy")]),e("b-button",{directives:[{name:"show",rawName:"v-show",value:t.srcPath,expression:"srcPath"}],staticClass:"ml-2",attrs:{variant:"primary"},on:{click:function(a){t.srcPath=""}}},[t._v("Cancel")]),e("span",{directives:[{name:"show",rawName:"v-show",value:t.loadingbarData.show,expression:"loadingbarData.show"}]},[e("span",{staticClass:"mx-3"},[t._v(t._s(t.loadingbarData.info))]),e("b-spinner",{staticClass:"float-right",attrs:{variant:"primary",label:"Spinning"}})],1)],1),e("b-table",{staticClass:"border rounded mt-2",attrs:{hover:"",responsive:"",id:"list-table",items:t.list,fields:t.fields,busy:t.loadingData.isBusy,"primary-key":"nameFormat","head-variant":"light","per-page":t.pageData.perPage,"current-page":t.pageData.currentPage},scopedSlots:t._u([{key:"cell(nameFormat)",fn:function(a){return[e("div",{staticClass:"opt-div"},[e("b-icon",{staticClass:"opt-icon",attrs:{icon:"command",scale:"1.25","shift-v":"1.25","aria-hidden":"true"}}),e("div",{staticClass:"opt-btns"},[e("b-button-group",{attrs:{vertical:""}},[e("b-button",{on:{click:function(e){return t.optBtnClick("rm",a.item.name)}}},[t._v("Delete")]),e("b-button",{on:{click:function(e){return t.optBtnClick("ren",a.item.name)}}},[t._v("Rename")]),e("b-button",{on:{click:function(e){return t.optBtnClick("mv_",a.item.name)}}},[t._v("Move")]),e("b-button",{on:{click:function(e){return t.optBtnClick("cp_",a.item.name)}}},[t._v("Copy")])],1)],1)],1),a.item.type?e("a",{attrs:{href:"#"},on:{click:function(e){return t.chwd(a.item.name+"/")}}},[t._v(t._s(a.item.name)+"/")]):e("span",[t._v(t._s(a.item.name))])]}},{key:"table-busy",fn:function(){return[e("div",{staticClass:"text-center text-primary my-2"},[e("b-spinner",{staticClass:"align-middle"}),e("strong",[t._v(t._s(t.loadingData.info))])],1)]},proxy:!0}])}),e("div",{staticClass:"overflow-auto",staticStyle:{display:"flex","justify-content":"flex-end"}},[e("b-pagination",{attrs:{"total-rows":t.list.length,"per-page":t.pageData.perPage,"aria-controls":"list-table"},model:{value:t.pageData.currentPage,callback:function(a){t.$set(t.pageData,"currentPage",a)},expression:"pageData.currentPage"}}),e("b-form-select",{staticClass:"mb-3 ml-2",staticStyle:{width:"100px"},attrs:{options:t.pageData.pageOptions},model:{value:t.pageData.perPage,callback:function(a){t.$set(t.pageData,"perPage",a)},expression:"pageData.perPage"}})],1),e("div",{staticClass:"fixed-bottom"},[e("b-alert",{attrs:{show:t.alertData.dismissCountDown,dismissible:"",fade:"",variant:t.alertData.type},on:{"dismiss-count-down":t.countDownChanged}},[t._v(t._s(t.alertData.info))])],1),e("b-modal",{attrs:{id:"modal-confirm",title:t.confirmData.title},on:{ok:t.confirmData.okclick}},[e("p",{staticClass:"my-4"},[t._v(t._s(t.confirmData.info))])]),e("b-modal",{attrs:{id:"modal-prompt",title:t.promptData.title},on:{show:t.resetPrompt,ok:t.handleOkPrompt}},[e("form",{ref:"form-prompt",on:{submit:function(a){return a.stopPropagation(),a.preventDefault(),t.handleOkPrompt()}}},[e("b-form-group",{attrs:{state:t.promptData.state,label:t.promptData.info,"invalid-feedback":"input is invalid"}},[e("b-form-input",{attrs:{state:t.promptData.state,required:""},model:{value:t.promptData.value,callback:function(a){t.$set(t.promptData,"value",a)},expression:"promptData.value"}})],1)],1)]),e("b-modal",{attrs:{id:"modal-touch",size:"lg",title:"touch a new file"},on:{ok:function(a){return t.optBtnClick("touch")}}},[e("form",{ref:"form-touch",on:{submit:function(t){t.stopPropagation(),t.preventDefault()}}},[e("b-form-group",{attrs:{label:"file name:"}},[e("b-form-input",{model:{value:t.uploadData.uploadTouch.name,callback:function(a){t.$set(t.uploadData.uploadTouch,"name",a)},expression:"uploadData.uploadTouch.name"}})],1),e("b-form-group",{attrs:{label:"file content:"}},[e("b-form-textarea",{attrs:{placeholder:"here is the file content",rows:"8","max-rows":"16"},model:{value:t.uploadData.uploadTouch.content,callback:function(a){t.$set(t.uploadData.uploadTouch,"content",a)},expression:"uploadData.uploadTouch.content"}})],1)],1)]),e("b-modal",{attrs:{id:"modal-upload",size:"lg",title:"upload status",scrollable:"","hide-footer":"","hide-header":""}},[e("div",{staticClass:"container"},[t.uploadData.uploadNow?e("div",[e("p",[t._v("now")]),t._v(" "+t._s(t.uploadData.uploadNow.file.name)+" "),e("b-progress",{attrs:{value:t.uploadData.uploadSize,max:t.uploadData.uploadNow.file.size,"show-progress":"",animated:""}})],1):t._e(),e("p",[t._v("waiting")]),t._l(t.uploadData.uploadQueue,(function(a){return e("p",{key:a},[t._v(" "+t._s(a.file.name)+" -- "+t._s(t.common.formatSize(a.file.size))+" -- "+t._s(a.path)+" ")])})),e("p",[t._v("fail")]),t._l(t.uploadData.uploadFail,(function(a){return e("p",{key:a},[t._v(" "+t._s(a.file.name)+" -- "+t._s(t.common.formatSize(a.file.size))+" -- "+t._s(a.path)+" ")])})),e("p",[t._v("success")]),t._l(t.uploadData.uploadSucess,(function(a){return e("p",{key:a},[t._v(" "+t._s(a.file.name)+" -- "+t._s(t.common.formatSize(a.file.size))+" -- "+t._s(a.path)+" ")])}))],2)]),e("input",{ref:"upload-files",staticClass:"d-none",attrs:{type:"file",multiple:""},on:{change:t.uploadOnChange}}),e("input",{ref:"upload-folder",staticClass:"d-none",attrs:{type:"file",webkitdirectory:""},on:{change:t.uploadOnChange}})],1)},H=[],Q=(e("99af"),e("7db0"),e("baa5"),e("a434"),e("a9e3"),e("8a79"),{data:function(){return{nowPath:"/",list:[],nextToken:"",listCache:{},pageData:{currentPage:1,perPage:10,pageOptions:[{text:"10/Page",value:10},{text:"50/Page",value:50}]},srcPath:"",cmdType:"",uploadData:{uploadQueue:[],uploadSucess:[],uploadFail:[],uploadNow:null,uploadSize:0,uploadTouch:{name:"",content:""}},searchData:{text:"",parentPath:"",content:[]},loadingbarData:{show:!1,info:"default info"},loadingData:{isBusy:!1,info:"default info"},alertData:{dismissCountDown:0,type:"primary",info:"default info"},confirmData:{title:"default title",info:"default info",okclick:function(){console.log("default click")}},promptData:{title:"default title",info:"default info",okclick:function(){console.log("default click")},value:"",state:null},fields:[{key:"nameFormat",label:"Name"},{key:"time",label:"Time",formatter:this.common.formatDate},{key:"size",label:"Size",class:"text-right",formatter:this.common.formatSize}]}},created:function(){this.updateList()},methods:{chwd:function(t){t.startsWith("/")?this.updateList(t):this.updateList(this.nowPath+t)},loadNextContent:function(t){console.log(t)},updateList:function(t,a){var e,n=this;return t||(t=this.nowPath,e=!0),!this.listCache[t]||e||a?this.loadingData.isBusy?this.showAlert("Processing other tasks, try again later","w"):(this.loadingData.isBusy=!0,this.loadingData.info="loading... "+t,console.log("try: ls "+t+(a?"?spPage="+a:"")),void this.common.axios.post("./api/cmd",{cmdType:"ls",cmdData:{path:t,spPage:a}}).then((function(e){n.loadingData.isBusy=!1,console.log(e.data),e.data.list?(n.nowPath=t,a?(e.data.list.forEach((function(a){return n.listCache[t].list.push(a)})),n.listCache[t].nextToken=e.data.nextToken):n.listCache[t]=e.data,n.list=n.listCache[t].list,n.nextToken=e.data.nextToken):console.log(e.data)})).catch((function(t){n.loadingData.isBusy=!1,console.log(t),void 0!==t.response?401===t.response.status?n.$router.push({path:"/login"}):n.showAlert("error: "+t.response.data.info,"d"):n.showAlert("error: "+t.message,"d")}))):(this.list=this.listCache[t].list,this.nextToken=this.listCache[t].nextToken,void(this.nowPath=t))},sendCmd:function(t,a){var e=this,n=this,o=i();function i(){switch(t){case"mkdir":return"mkdir "+a.path+a.name;case"mv":case"cp":return t+" "+a.srcPath+" "+a.desPath;case"rm":return"rm "+a.path;case"ren":return"ren "+a.path+" "+a.name;case"touch":case"upload":return t+" "+a.path+(a.name||"");case"find":return t+" "+a.path+" "+a.text;default:return"unknown: "+t}}function s(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";t.endsWith("/")&&(t=t.slice(0,-1));var a=t.lastIndexOf("/")+1;return{path:t.slice(0,a),name:t.slice(a)}}console.log("try: "+o),this.loadingbarData.info=o,this.loadingbarData.show=!0,this.common.axios.post("./api/cmd",{cmdType:t,cmdData:a}).then((function(o){var i,r,l,c;switch(e.loadingbarData.show=!1,t){case"mkdir":return void n.listCache[a.path].list.unshift({type:1,name:a.name,size:0,mime:"folder/unknown",time:n.common.formatDate(new Date)});case"mv":case"cp":return i=s(a.srcPath),r=-1,l=n.listCache[i.path].list.find((function(t,a){return r=a,t.name===i.name})),"mv"===t&&n.listCache[i.path].list.splice(r,1),void n.listCache[a.desPath].list.unshift(l);case"rm":case"ren":return i=s(a.path),r=-1,l=n.listCache[i.path].list.find((function(t,a){return r=a,t.name===i.name})),void("rm"===t?n.listCache[i.path].list.splice(r,1):l.name=a.name);case"touch":return void n.listCache[a.path].list.unshift({type:0,name:a.name,size:n.common.formatSize(a.content.length),mime:"onepoint/unknown",time:n.common.formatDate(new Date)});case"upload":return c=o.data.json.uploadUrl,void n.common.axios.get(c,{withCredentials:!1}).then((function(t){n.fileUpload(t.data,c)}));case"find":return n.nowPath=o.data.parentPath,void(n.content=o.data.data.content);default:return void console.log("unknown: "+t)}})).catch((function(a){n.loadingbarData.show=!1,console.log(a),void 0!==a.response?n.showAlert("error: "+a.response.data.info,"d"):n.showAlert("error: "+a.message,"d"),"upload"===t&&n.uploadData.uploadNow&&(n.uploadData.uploadFail.unshift(n.uploadData.uploadNow),n.uploadData.uploadNow=null,a.response&&409===a.response.status&&n.optBtnClick("upload"))}))},optBtnClick:function(t){var a,e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=this.nowPath+n,i=this;switch(t){case"mkdir":return void this.showPrompt("mkdir","make dir in: "+o,(function(a){i.sendCmd(t,{path:o,name:a})}));case"mv_":return this.cmdType="mv",void(this.srcPath=o);case"mv":if(!this.srcPath||this.srcPath.slice(0,this.srcPath.lastIndexOf("/")+1)===this.nowPath)return;return void this.showConfirm("mv","move :"+this.srcPath+" -> "+this.nowPath,(function(){i.sendCmd(t,{srcPath:e.srcPath,desPath:e.nowPath}),i.srcPath=""}));case"cp_":return this.cmdType="cp",void(this.srcPath=o);case"cp":if(!this.srcPath||this.srcPath.slice(0,this.srcPath.lastIndexOf("/")+1)===this.nowPath)return;return void this.showConfirm("cp","copy :"+this.srcPath+" -> "+this.nowPath,(function(){i.sendCmd(t,{srcPath:e.srcPath,desPath:e.nowPath}),i.srcPath=""}));case"rm":return void this.showConfirm("rm","remove: "+o,(function(){i.sendCmd(t,{path:o})}));case"ren":return void this.showPrompt("ren","rename: "+o,(function(a){i.sendCmd(t,{path:o,name:a})}));case"touch":if(!this.uploadData.uploadTouch.name)return;return this.sendCmd(t,{path:this.nowPath,name:this.uploadData.uploadTouch.name,content:this.uploadData.uploadTouch.content||""}),this.uploadData.uploadTouch.name="",void(this.uploadData.uploadTouch.content="");case"upload":if(this.uploadData.uploadNow||0===this.uploadData.uploadQueue.length)return;return this.uploadData.uploadNow=this.uploadData.uploadQueue.shift(),a=this.uploadData.uploadNow,void this.sendCmd(t,{path:a.path+a.file.name,fileSystemInfo:{lastModifiedDateTime:a.file.lastModifiedDate.toISOString()}});case"find":return void this.sendCmd(t,{path:this.nowPath,text:this.searchData.text});default:return void console.log("err: "+t)}},showAlert:function(t,a){this.alertData.dismissCountDown=5,this.alertData.type={i:"info",d:"danger",s:"success",w:"warning"}[a]||"primary",this.alertData.info=t},countDownChanged:function(t){this.alertData.dismissCountDown=t},showConfirm:function(t,a,e){this.confirmData.title=t,this.confirmData.info=a,this.confirmData.okclick=e,this.$bvModal.show("modal-confirm")},showPrompt:function(t,a,e){this.promptData.title=t,this.promptData.info=a,this.promptData.okclick=e,this.$bvModal.show("modal-prompt")},resetPrompt:function(){this.promptData.value="",this.promptData.state=null},handleOkPrompt:function(t){var a=this;t&&t.preventDefault();var e=this.$refs["form-prompt"].checkValidity();this.promptData.state=e,e&&(this.promptData.okclick(this.promptData.value),this.$nextTick((function(){a.$bvModal.hide("modal-prompt")})))},uploadBtnClick:function(t){this.$refs[t].click()},uploadOnChange:function(t){console.log(t.target.files);for(var a=t.target.files,e=0;e<a.length;e++)this.uploadData.uploadQueue.push({path:this.nowPath,file:a[e],time:new Date});this.optBtnClick("upload")},fileUpload:function(t,a){var e,n,o,i,s=this;i=this.uploadData.uploadNow.file;var r=t.nextExpectedRanges[0].split("-");e=Number(r[0]),n=r[1]?Number(r[1])+1:i.size,o=a||t.uploadUrl,n>e+10485760&&(n=e+10485760);var l=new FileReader;l.readAsArrayBuffer(i.slice(e,n)),l.onload=function(a){console.log("send: ["+e+","+n+")"),s.common.axios.put(o,a.target.result,{headers:{"Content-Range":"bytes ".concat(e,"-").concat(n-1,"/").concat(i.size)},onUploadProgress:function(t){var a=t.loaded;s.uploadData.uploadSize=e+a},withCredentials:!1}).then((function(a){if(console.log(a.data),console.log("success: ["+e+","+n+")"),201===a.status)return s.listCache[s.uploadData.uploadNow.path].list.unshift({type:1,name:s.uploadData.uploadNow.file.name,size:s.common.formatSize(s.uploadData.uploadNow.file.size),mime:"onepoint/unknown",time:s.common.formatDate(s.uploadData.uploadNow.file.lastModifiedDate)}),s.showAlert("success: upload"+s.uploadData.uploadNow.file.name,"i"),console.log("success: "+JSON.stringify(t)),s.uploadData.uploadSucess.push(s.uploadData.uploadNow),s.uploadData.uploadNow=null,void s.optBtnClick("upload");if(202!==a.status)throw a;s.fileUpload(a.data,o)})).catch((function(t){console.log(t),s.showAlert("error: "+t.message,"d"),s.uploadData.uploadNow&&(console.error("fail: upload "+i.name),s.uploadData.uploadFail.unshift(s.uploadData.uploadNow),s.uploadData.uploadNow=null)}))}}},computed:{navPathArr:function(){var t=this.nowPath,a="/",e=[];return t.split("/").forEach((function(t){t&&(a+=t,a+="/",e.push({path:t,href:a}))})),e}}}),J=Q,W=(e("f50a"),Object(u["a"])(J,R,H,!1,null,null,null)),q=W.exports,G=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"container mt-3"},[e("b-form-input",{attrs:{placeholder:"Search"},model:{value:t.keyText,callback:function(a){t.keyText=a},expression:"keyText"}}),e("b-table",{staticClass:"border rounded mt-3",attrs:{hover:"",responsive:"",items:t.cacheFilter,fields:t.fields,"head-variant":"light","per-page":t.perPage,"current-page":t.currentPage}}),e("div",{staticClass:"overflow-auto",staticStyle:{display:"flex","justify-content":"center"}},[e("b-pagination",{attrs:{"total-rows":t.cacheFilter.length,"per-page":t.perPage,"first-text":"First","prev-text":"Prev","next-text":"Next","last-text":"Last"},model:{value:t.currentPage,callback:function(a){t.currentPage=a},expression:"currentPage"}}),e("b-form-select",{staticClass:"mb-3 ml-2",staticStyle:{width:"100px"},attrs:{options:t.pageOptions},model:{value:t.perPage,callback:function(a){t.perPage=a},expression:"perPage"}})],1)],1)},K=[],Y=(e("4de4"),e("caad"),e("2532"),{data:function(){return{cache:[],keyText:"",fields:["path",{key:"data",formatter:JSON.stringify}],currentPage:1,perPage:10,pageOptions:[{text:"10/Page",value:10},{text:"50/Page",value:50}]}},beforeCreate:function(){var t=this;this.common.axios.get("./admin/ajax/cache").then((function(a){t.cache=a.data})).catch((function(a){t.cache.push({path:"error",data:a})}))},methods:{},computed:{cacheFilter:function(){var t=this;return this.keyText?this.cache.filter((function(a){return a.path.includes(t.keyText)})):this.cache}}}),X=Y,Z=Object(u["a"])(X,G,K,!1,null,null,null),tt=Z.exports,at=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"container"},[e("div",{staticClass:"my-3"},[e("b-button",{staticStyle:{"min-width":"80px"},attrs:{href:"#",variant:"primary"},on:{click:function(a){t.editable=!t.editable}}},[t._v(t._s(t.editable?"取消":"编辑"))]),e("b-button",{staticClass:"mx-3",staticStyle:{"min-width":"80px"},attrs:{href:"#",variant:"danger",disabled:!t.editable},on:{click:t.saveConfig}},[t._v("保存")]),e("p",{staticClass:"d-inline"},[t._v("谨慎使用，除非你知道到底在做什么")])],1),e("b-form-textarea",{attrs:{id:"textarea",placeholder:"Enter something...",rows:"50","max-rows":"200",disabled:!t.editable},model:{value:t.config,callback:function(a){t.config=a},expression:"config"}})],1)},et=[],nt={data:function(){return{config:"default info",editable:!1}},created:function(){var t=this;this.common.axios.get("./admin/ajax/setting").then((function(a){console.log(a.data),t.config=JSON.stringify(a.data,null,2)}))},methods:{saveConfig:function(){var t;try{if(t=JSON.parse(this.config),!t.G_CONFIG||!t.DRIVE_MAP)return alert("invalid config")}catch(a){return alert("invalid json")}this.common.axios.post("./admin/ajax/save",t).then((function(t){alert(t.data)})).catch((function(t){console.log(t),alert("failed")}))}}},ot=nt,it=Object(u["a"])(ot,at,et,!1,null,null,null),st=it.exports;n["default"].use(m["a"]);var rt=[{path:"/dashboard",name:"Dashboard",component:V},{path:"/files",name:"Files",component:q},{path:"/cache",name:"Cache",component:tt},{path:"/setting",name:"Setting",component:st},{path:"/home*",name:"Home",component:N},{path:"/login",name:"Login",component:E},{path:"/*",name:"Home1",component:N}],lt=new m["a"]({routes:rt}),ct=lt,ut=e("2f62");n["default"].use(ut["a"]);var dt=new ut["a"].Store({state:{isadmin:!1},mutations:{loginSuccess:function(t){t.isadmin=!0},logoutSuccess:function(t){t.isadmin=!1}},actions:{},modules:{}}),pt=(e("b680"),e("6821")),mt=e.n(pt),ht=e("bc3a"),ft=e.n(ht),vt=/(.+)\/admin/.exec(window.location.href),gt=vt?vt[1]:"http://127.0.0.1",bt={p_h0:gt,md5:mt.a,axios:ft.a.create({baseURL:gt+"/",withCredentials:!0}),formatDate:function(t){var a=new Date(t);if("Invalid Date"==a)return a;var e=a.getFullYear(),n=a.getMonth()<9?"0"+(a.getMonth()+1):a.getMonth()+1,o=a.getDate()<10?"0"+a.getDate():a.getDate(),i=a.getHours()<10?"0"+a.getHours():a.getHours(),s=a.getMinutes()<10?"0"+a.getMinutes():a.getMinutes(),r=a.getSeconds()<10?"0"+a.getSeconds():a.getSeconds(),l=e+"-"+n+"-"+o+" "+i+":"+s+":"+r;return l},formatSize:function(t){"number"!==typeof t&&(t=NaN);var a=0;while(t>=1024)t/=1024,a++;return t=t.toFixed(2),t+=[" B"," KB"," MB"," GB"][a],t},urlSpCharEncode:function(t){if(!t)return t;for(var a="",e=t.length,n=0;n<e;n++){var o=t[n];switch(o){case"%":a+="%25";break;case"?":a+="%3f";break;case"#":a+="%23";break;case" ":a+="%20";break;default:a+=o}}return a}},wt=bt,yt=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("b-modal",{attrs:{centered:!0,title:t.title,"cancel-title":t.cancelTitle,"ok-title":t.okTitle},on:{ok:t.modalOk,cancel:t.modalCancel,close:t.modalClose},model:{value:t.isShow,callback:function(a){t.isShow=a},expression:"isShow"}},[e("p",{staticClass:"my-4"},[t._v(t._s(t.message))])])},Dt=[],kt={props:{isShow:{type:Boolean,default:!1},message:{type:[String,Number],default:"default message"},title:{type:[String],default:"Confirm"},cancelTitle:{type:String,default:"取消"},okTitle:{type:String,default:"确定"},ok:{type:Function,default:null},cancel:{type:Function,default:null},close:{type:Function,default:null}},methods:{modalOk:function(){this.ok&&this.ok()},modalCancel:function(){this.cancel&&this.cancel()},modalClose:function(){this.close&&this.close()}}},_t=kt,Ct=Object(u["a"])(_t,yt,Dt,!1,null,null,null),xt=Ct.exports,Pt={},St={isShow:!0,message:"default message",title:"Confirm",cancelTitle:"取消",okTitle:"确定",ok:null,cancel:null,close:null};Pt.install=function(t){var a=t.extend(xt),e=new a;e.$mount(),document.body.appendChild(e.$el),t.prototype.$confirm=function(t){Object.assign(e,St,t)}};var Tt=Pt,$t=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("b-modal",{attrs:{centered:!0,title:t.title,"cancel-title":t.cancelTitle,"ok-title":t.okTitle},on:{ok:t.modalOk,cancel:t.modalCancel,close:t.modalClose,show:t.resetModal},model:{value:t.isShow,callback:function(a){t.isShow=a},expression:"isShow"}},[e("form",{ref:"prompt-form",on:{submit:function(a){return a.stopPropagation(),a.preventDefault(),t.handleSubmit(a)}}},[e("b-form-group",{attrs:{state:t.formState,label:t.message,"invalid-feedback":t.invalid}},[e("b-form-input",{attrs:{state:t.formState,required:""},model:{value:t.formValue,callback:function(a){t.formValue=a},expression:"formValue"}})],1)],1)])},Nt=[],Ot={data:function(){return{isShow:!1,message:"default message",title:"Confirm",cancelTitle:"取消",okTitle:"确定",ok:null,cancel:null,close:null,regex:/.+/,invalidTips:"",formValue:"",formState:null}},methods:{handleSubmit:function(){var t=this;this.formState=this.regex.test(this.formValue),this.formState&&(this.ok&&this.ok(this.formValue),this.$nextTick((function(){t.isShow=!1})))},resetModal:function(){this.formValue="",this.formState=null},modalOk:function(t){t.preventDefault(),this.handleSubmit()},modalCancel:function(){this.cancel&&this.cancel()},modalClose:function(){this.close&&this.close()}},computed:{invalid:function(){return this.invalidTips||"invalid input, expected: "+this.regex}}},Bt=Ot,jt=Object(u["a"])(Bt,$t,Nt,!1,null,null,null),Ft=jt.exports,zt={},Et={isShow:!0,message:"default message",title:"input",cancelTitle:"取消",okTitle:"确定",ok:null,cancel:null,close:null,regex:/.+/,invalidTips:""};zt.install=function(t){var a=t.extend(Ft),e=new a;e.$mount(),document.body.appendChild(e.$el),t.prototype.$prompt=function(t){Object.assign(e,Et,t)}};var It=zt;n["default"].use(o["a"]),n["default"].use(i["a"]),n["default"].config.productionTip=!1,n["default"].prototype.common=wt,n["default"].use(Tt),n["default"].use(It);var Mt=new n["default"]({router:ct,store:dt,render:function(t){return t(p)}}).$mount("#app");n["default"].prototype.$message=function(t,a,e){a={i:"info",d:"danger",s:"success",w:"warning"}[a]||"primary",Mt.$bvToast.toast(t,{title:e||a,variant:a,solid:!0})},console.log("200224测试版本,如果发现问题请到github反馈")},a66a:function(t,a,e){},f50a:function(t,a,e){"use strict";var n=e("a66a"),o=e.n(n);o.a}});
//# sourceMappingURL=app.7fe68977.js.map