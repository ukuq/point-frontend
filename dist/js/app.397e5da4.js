(function(t){function e(e){for(var o,s,r=e[0],l=e[1],c=e[2],u=0,p=[];u<r.length;u++)s=r[u],Object.prototype.hasOwnProperty.call(i,s)&&i[s]&&p.push(i[s][0]),i[s]=0;for(o in l)Object.prototype.hasOwnProperty.call(l,o)&&(t[o]=l[o]);d&&d(e);while(p.length)p.shift()();return n.push.apply(n,c||[]),a()}function a(){for(var t,e=0;e<n.length;e++){for(var a=n[e],o=!0,r=1;r<a.length;r++){var l=a[r];0!==i[l]&&(o=!1)}o&&(n.splice(e--,1),t=s(s.s=a[0]))}return t}var o={},i={app:0},n=[];function s(e){if(o[e])return o[e].exports;var a=o[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.m=t,s.c=o,s.d=function(t,e,a){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)s.d(a,o,function(e){return t[e]}.bind(null,o));return a},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],l=r.push.bind(r);r.push=e,r=r.slice();for(var c=0;c<r.length;c++)e(r[c]);var d=l;n.push([0,"chunk-vendors"]),a()})({0:function(t,e,a){t.exports=a("56d7")},"00cb":function(t,e,a){},"034f":function(t,e,a){"use strict";var o=a("296e"),i=a.n(o);i.a},"296e":function(t,e,a){},"29a4":function(t,e,a){"use strict";var o=a("00cb"),i=a.n(o);i.a},"56d7":function(t,e,a){"use strict";a.r(e);a("e260"),a("e6cf"),a("cca6"),a("a79d");var o=a("2b0e"),i=a("cca8"),n=a("521d"),s=a("3c97"),r=a("7049"),l=a("8b3d"),c=a("a7e2"),d=a("8c60"),u=a("cbd0"),p=a("1073"),m=a("b1fc"),f=a("44d4"),h=a("a166"),g=a("bdc5"),v=a("9ae9"),b=a("e68d"),_=a("dbbe"),w=a("f9bc"),x=a("d435"),y=a("40aa"),D=a("b519"),k=a("1f1a"),C=a("51c2"),P=a("b1e0"),S=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("b-modal",{attrs:{centered:!0,title:t.title,"cancel-title":t.cancelTitle,"ok-title":t.okTitle},on:{ok:t.modalOk,cancel:t.modalCancel,close:t.modalClose},model:{value:t.isShow,callback:function(e){t.isShow=e},expression:"isShow"}},[a("p",{staticClass:"my-4",staticStyle:{overflow:"auto"}},[t._v(t._s(t.message))])])},$=[],N={data:function(){return{isShow:!1,message:"default message",title:"Confirm",cancelTitle:"取消",okTitle:"确定",ok:null,cancel:null,close:null}},methods:{modalOk:function(){this.ok&&this.ok()},modalCancel:function(){this.cancel&&this.cancel()},modalClose:function(){this.close&&this.close()}}},T=N,O=a("2877"),j=Object(O["a"])(T,S,$,!1,null,null,null),B=j.exports,F={isShow:!0,message:"default message",title:"Confirm",cancelTitle:"取消",okTitle:"确定",ok:null,cancel:null,close:null},I={install:function(t){var e=t.extend(B),a=new e;a.$mount(),document.body.appendChild(a.$el),t.prototype.$confirm=function(t){Object.assign(a,F,t)}}},E=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("b-modal",{attrs:{centered:!0,title:t.title,"cancel-title":t.cancelTitle,"ok-title":t.okTitle},on:{ok:t.modalOk,cancel:t.modalCancel,close:t.modalClose,show:t.resetModal},model:{value:t.isShow,callback:function(e){t.isShow=e},expression:"isShow"}},[a("form",{ref:"prompt-form",on:{submit:function(e){return e.stopPropagation(),e.preventDefault(),t.handleSubmit(e)}}},[a("b-form-group",{attrs:{state:t.formState,label:t.message,"invalid-feedback":t.invalid}},[a("b-form-input",{attrs:{state:t.formState,required:""},model:{value:t.formValue,callback:function(e){t.formValue=e},expression:"formValue"}})],1)],1)])},z=[],M={data:function(){return{isShow:!1,message:"default message",title:"Confirm",cancelTitle:"取消",okTitle:"确定",ok:null,cancel:null,close:null,regex:/.+/,invalidTips:"",formValue:"",formState:null}},methods:{handleSubmit:function(){var t=this;this.formState=this.regex.test(this.formValue),this.formState&&(this.ok&&this.ok(this.formValue),this.$nextTick((function(){t.isShow=!1})))},resetModal:function(){this.formValue="",this.formState=null},modalOk:function(t){t.preventDefault(),this.handleSubmit()},modalCancel:function(){this.cancel&&this.cancel()},modalClose:function(){this.close&&this.close()}},computed:{invalid:function(){return this.invalidTips||"invalid input, expected: "+this.regex}}},U=M,L=Object(O["a"])(U,E,z,!1,null,null,null),A=L.exports,V={},R={isShow:!0,message:"default message",title:"input",cancelTitle:"取消",okTitle:"确定",ok:null,cancel:null,close:null,regex:/.+/,invalidTips:""};V.install=function(t){var e=t.extend(A),a=new e;a.$mount(),document.body.appendChild(a.$el),t.prototype.$prompt=function(t){Object.assign(a,R,t)}};var G=V;o["default"].use(i["a"]),o["default"].use(n["a"]),o["default"].use(s["a"]),o["default"].use(r["a"]),o["default"].use(l["a"]),o["default"].use(c["a"]),o["default"].use(d["a"]),o["default"].use(u["a"]),o["default"].use(p["a"]),o["default"].use(m["a"]),o["default"].use(f["a"]),o["default"].use(h["a"]),o["default"].use(g["a"]),o["default"].use(v["a"]),o["default"].use(b["a"]),o["default"].use(_["a"]),o["default"].use(w["a"]),o["default"].use(x["a"]),o["default"].use(y["a"]),o["default"].use(D["a"]),o["default"].use(k["a"]),o["default"].use(C["a"]),o["default"].use(P["a"]),o["default"].use(I),o["default"].use(G);a("f9e3"),a("2dd8");var J=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"app"}},[a("b-navbar",{attrs:{toggleable:"lg",type:"dark",variant:"dark",sticky:""}},[a("div",{staticClass:"container"},[a("b-navbar-brand",{attrs:{href:"#"}},[a("img",{staticClass:"d-inline-block align-top",attrs:{src:"https://cdn.onesrc.cn/uploads/images/onepoint_30.png",alt:"logo"}}),t._v(" ONEPOINT ")]),a("b-navbar-toggle",{attrs:{target:"nav-collapse"}}),a("b-collapse",{attrs:{id:"nav-collapse","is-nav":""}},[a("b-navbar-nav",[a("li",{staticClass:"nav-item"},[a("router-link",{staticClass:"nav-link",attrs:{to:"/home"}},[t._v("Home")])],1),t.$store.state.isadmin?[a("li",{staticClass:"nav-item"},[a("router-link",{staticClass:"nav-link",attrs:{to:"/files"}},[t._v("Files")])],1),a("b-nav-item-dropdown",{attrs:{text:"Setting"}},[a("li",[a("router-link",{staticClass:"dropdown-item",attrs:{to:"/setting/site"}},[t._v("网站信息")])],1),a("li",[a("router-link",{staticClass:"dropdown-item",attrs:{to:"/setting/drives"}},[t._v("云盘挂载")])],1),a("li",[a("router-link",{staticClass:"dropdown-item",attrs:{to:"/setting/password"}},[t._v("密码设置")])],1),a("li",[a("router-link",{staticClass:"dropdown-item",attrs:{to:"/setting/dev"}},[t._v("开发者设置")])],1)]),a("li",{staticClass:"nav-item"},[a("router-link",{staticClass:"nav-link",attrs:{to:"/cache"}},[t._v("Cache")])],1),a("li",{staticClass:"nav-item"},[a("router-link",{staticClass:"nav-link",attrs:{to:"/dashboard"}},[t._v("Dashboard")])],1)]:t._e()],2),a("b-navbar-nav",{staticClass:"ml-auto"},[t.$store.state.isadmin?a("b-nav-item",{attrs:{href:"logout",right:""},on:{click:function(e){return e.preventDefault(),t.logout(e)}}},[t._v("Logout")]):a("li",{staticClass:"nav-item"},[a("router-link",{staticClass:"nav-link",attrs:{to:"/login"}},[t._v("Login")])],1)],1)],1)],1)]),a("router-view"),t._m(0)],1)},W=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("p",{staticClass:"text-muted text-center m-3"},[t._v(" Designed by "),a("a",{attrs:{href:"https://www.onesrc.cn/"}},[t._v("ONESRC")]),t._v(" | Powered by "),a("a",{attrs:{href:"https://github.com/ukuq/onepoint"}},[t._v("OnePoint")]),t._v(". ")])}],H=(a("a9e3"),{beforeCreate:function(){var t=window.localStorage.getItem("loginTime");t&&Date.now()<Number(t)&&this.$store.commit("loginSuccess")},methods:{logout:function(){this.$store.commit("logoutSuccess"),this.common.axios.get("./admin/public/logout").catch((function(){})),this.$router.push({path:"/login"})}}}),Q=H,q=(a("034f"),Object(O["a"])(Q,J,W,!1,null,null,null)),K=q.exports,Y=a("8c4f"),X=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"container mt-3"},[a("div",{staticStyle:{position:"relative"}},[a("b-icon",{directives:[{name:"b-modal",rawName:"v-b-modal.setting-modal",modifiers:{"setting-modal":!0}}],staticStyle:{position:"absolute",right:"15px",top:"15px",cursor:"pointer"},attrs:{icon:"gear-fill",scale:"1.25",variant:"primary"}}),a("b-breadcrumb",[a("b-breadcrumb-item",{on:{click:function(e){return e.preventDefault(),t.chwd("/")}}},[a("b-icon",{attrs:{icon:"house-fill",scale:"1.25","shift-v":"1.25","shift-h":"-1","aria-hidden":"true"}}),t._v("Home ")],1),t._l(t.navPathArr,(function(e){return a("b-breadcrumb-item",{key:e.href,attrs:{href:e.href},on:{click:function(a){return a.preventDefault(),t.chwd(e.href)}}},[t._v(t._s(e.path))])}))],2)],1),t.aplayerData.isBusy?a("div",{staticClass:"mt-3",staticStyle:{position:"relative"}},[a("b-icon",{staticStyle:{position:"absolute",right:"5px","z-index":"1",cursor:"pointer"},attrs:{icon:"x",scale:"1.25"},on:{click:function(e){t.aplayerData.isBusy=!1}}}),a("aplayer",{attrs:{autoplay:"",list:t.audioList,music:t.aplayerData.music,repeat:t.aplayerData.repeat,shuffle:t.aplayerData.shuffle},on:{"update:music":function(e){return t.$set(t.aplayerData,"music",e)},"update:repeat":function(e){return t.$set(t.aplayerData,"repeat",e)},"update:shuffle":function(e){return t.$set(t.aplayerData,"shuffle",e)}}})],1):t._e(),a("b-table",{staticClass:"border rounded mt-2",attrs:{hover:"",responsive:"",items:t.list,fields:t.fields,"primary-key":"nameFormat","head-variant":"light","foot-variant":"null","selected-variant":"danger","per-page":t.pageData.perPage,"current-page":t.pageData.currentPage},scopedSlots:t._u([{key:"cell(nameFormat)",fn:function(e){return[1===e.item.type?[a("b-icon",{attrs:{icon:"folder",scale:"1.25","shift-h":"-3","aria-hidden":"true"}}),a("a",{attrs:{href:e.item.name+"/"},on:{click:function(a){return a.preventDefault(),t.chwd(e.item.name+"/")}}},[t._v(t._s(e.item.name)+"/")])]:3===e.item.type?[a("b-icon",{attrs:{icon:"inbox",scale:"1.25","shift-h":"-3","aria-hidden":"true"}}),a("a",{attrs:{href:e.item.name+"/"},on:{click:function(a){return a.preventDefault(),t.chwd(e.item.name+"/")}}},[t._v(t._s(e.item.name)+"/")])]:[a("b-icon",{attrs:{icon:"document",scale:"1.25","shift-h":"-3","aria-hidden":"true"}}),a("a",{staticClass:"mr-2",attrs:{href:e.item.name+"?preview"},on:{click:function(a){return a.preventDefault(),t.preview(e.item)}}},[t._v(t._s(e.item.name))]),a("a",{attrs:{href:t.common.p_h0+t.nowPath+e.item.name,target:"_blank"}},[a("b-icon",{attrs:{icon:"download",scale:"1.25","shift-h":"-3","aria-hidden":"true"}})],1)]]}},{key:"custom-foot",fn:function(){return[a("b-tr",[a("b-td",{staticClass:"py-1",staticStyle:{position:"relative"},attrs:{colspan:"3"}},[a("p",{staticClass:"mt-2",staticStyle:{position:"absolute"}},[t._v(t._s(t.siteinfo.proxy_cookie?"Proxy via: "+t.siteinfo.proxy_cookie:""))]),a("div",{staticClass:"overflow-auto",staticStyle:{display:"flex","justify-content":"flex-end"}},[a("b-pagination",{staticClass:"my-0 ml-2",attrs:{"total-rows":t.list.length,"per-page":t.pageData.perPage},model:{value:t.pageData.currentPage,callback:function(e){t.$set(t.pageData,"currentPage",e)},expression:"pageData.currentPage"}}),a("b-form-select",{staticClass:"ml-2",staticStyle:{"max-width":"100px"},attrs:{options:t.pageData.pageOptions},model:{value:t.pageData.perPage,callback:function(e){t.$set(t.pageData,"perPage",e)},expression:"pageData.perPage"}}),t.next?a("b-button",{staticClass:"ml-2",staticStyle:{"max-height":"37px"},on:{click:function(e){return t.updateList(t.nowPath,t.next)}}},[t._v(t._s(t.loadingData.isBusy?"loading...":"LoadMore"))]):t._e()],1)])],1)]},proxy:!0}])}),a("b-card",{staticClass:"mt-3",attrs:{"no-body":""}},[a("b-card-header",[t._v("README.md")]),a("b-card-body",[a("div",{domProps:{innerHTML:t._s(t.readme)}})])],1),a("b-modal",{attrs:{centered:"","hide-footer":"",title:t.dplayerData.title,size:"xl"},model:{value:t.dplayerData.isBusy,callback:function(e){t.$set(t.dplayerData,"isBusy",e)},expression:"dplayerData.isBusy"}},[a("video-player",{ref:"videoPlayer",attrs:{url:t.dplayerData.url,"vtt-url":t.dplayerData.vttUrl,path:t.dplayerData.path}})],1),a("b-modal",{attrs:{centered:"","hide-footer":"",title:t.imgData.title,size:"xl"},model:{value:t.imgData.isBusy,callback:function(e){t.$set(t.imgData,"isBusy",e)},expression:"imgData.isBusy"}},[a("div",{staticStyle:{display:"flex","justify-content":"center"}},[a("b-img",{attrs:{src:t.imgData.url,fluid:"",alt:"Responsive image"}})],1)]),a("b-modal",{attrs:{centered:"","hide-footer":"",title:t.textData.title,size:"xl"},on:{show:t.previewText},model:{value:t.textData.isBusy,callback:function(e){t.$set(t.textData,"isBusy",e)},expression:"textData.isBusy"}},[a("pre",[a("code",{},[t._v(t._s(t.textData.text))])])]),a("b-modal",{ref:"setting",attrs:{id:"setting-modal",title:"Setting",centered:"","hide-footer":""}},[a("label",[t._v("DPlayer Setting")]),a("b-form-select",{attrs:{options:t.dplayerData.showVttOpt},model:{value:t.dplayerData.showVtt,callback:function(e){t.$set(t.dplayerData,"showVtt",e)},expression:"dplayerData.showVtt"}}),a("label",[t._v("Proxy Setting")]),a("b-form-select",{attrs:{options:t.siteinfo.proxy},on:{change:t.updateProxy},model:{value:t.siteinfo.proxy_cookie,callback:function(e){t.$set(t.siteinfo,"proxy_cookie",e)},expression:"siteinfo.proxy_cookie"}})],1)],1)},Z=[],tt=(a("99af"),a("7db0"),a("4160"),a("d81d"),a("fb6a"),a("b0c0"),a("ac1f"),a("1276"),a("2ca0"),a("159b"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"dplayer"}})}),et=[],at=(a("96cf"),a("1da1")),ot=(a("eccb"),a("f7a5")),it=a.n(ot),nt={name:"VideoPlayer",data:function(){return{options:{container:null,video:{url:""},subtitle:null,autoplay:!1},player:null}},props:{url:String,vttUrl:{type:String,default:""}},mounted:function(){var t=this;return Object(at["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.options.container=document.getElementById("dplayer"),t.vttUrl&&(t.options.subtitle={url:t.vttUrl,type:"webvtt",fontSize:"25px",bottom:"10%",color:"#b7daff"}),t.player=new it.a(t.options),t.player.switchVideo({url:t.url});case 4:case"end":return e.stop()}}),e)})))()},destroyed:function(){this.player.destroy()}},st=nt,rt=(a("29a4"),Object(O["a"])(st,tt,et,!1,null,null,null)),lt=rt.exports,ct=a("0f7d"),dt=a.n(ct),ut=a("e0c1"),pt=a.n(ut),mt=(a("e4cb"),{name:"Filelister",components:{VideoPlayer:lt,aplayer:dt.a},data:function(){return{aplayerData:{isBusy:!1,music:{src:"https://google.com/404"},repeat:"no-repeat",shuffle:!1},dplayerData:{isBusy:!1,url:"",vttUrl:"",path:"",title:"",showVtt:!0,showVttOpt:[{text:"加载vtt字幕",value:!0},{text:"不加载vtt字幕",value:!1}]},imgData:{isBusy:!1,url:"",title:""},textData:{text:"",url:"",isBusy:!1,title:""},readmeData:{text:"nothing",map:{}},nowPath:"/",listCache:{},pageData:{currentPage:1,perPage:10,pageOptions:[{text:"10/Page",value:10},{text:"50/Page",value:50}]},loadingData:{isBusy:!1,info:"default info"},fields:[{key:"nameFormat",label:"Name"},{key:"time",label:"Time",thStyle:"width:180px",class:"d-none d-md-table-cell",formatter:this.common.formatDate},{key:"size",label:"Size",thStyle:"width:120px",class:"text-right mr-3 d-none d-md-table-cell",formatter:this.common.formatSize}],siteinfo:{site_name:"",site_readme:"",proxy:[{text:"no proxy",value:""}],proxy_cookie:""}}},created:function(){this.nowPath=this.$route.params.pathMatch||"/",this.updateList(this.nowPath),this.updateTarget(this.common.p_h0)},methods:{chwd:function(t){t.startsWith("/")?this.updateList(t):this.updateList(this.nowPath+t)},updateList:function(t){var e=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2?arguments[2]:void 0;if(this.nowPath===t||(this.$router.push({path:"/home"+t}),this.nowPath=t,!this.listCache[t])){if(this.loadingData.isBusy)return this.$message("Processing other tasks, try again later","i");this.loadingData.isBusy=!0,this.loadingData.info="loading... "+t+a,console.log("try: ls "+t+a);var i=this,n=".".concat(this.common.urlSpCharEncode(t),"?json").concat(a?"&"+a.slice(1):"");this.common.axios({url:n,method:o?"post":"get",data:o}).then((function(o){i.loadingData.isBusy=!1,o.data.list?(a?(o.data.list.forEach((function(e){return i.listCache[t].list.push(e)})),i.listCache[t].next=o.data.next):i.$set(i.listCache,t,o.data),o.data.list.find((function(t){return 0===t.type&&"README.md"===t.name}))&&e.genReadme(t)):console.log(o.data)})).catch((function(e){if(i.loadingData.isBusy=!1,console.log(e),e.response){if(401!==e.response.status)return i.$message("error: "+e.response.data.info,"d");var o=e.response.data.info.split(":");i.$prompt({title:"密码验证",message:o[1],ok:function(e){var n={};n[o[0]]=e,i.updateList(t,a,n)}})}else i.$message("error: "+e.message,"d")}))}},preview:function(t){var e=this.nowPath+t.name,a=this.common.p_h0+this.common.urlSpCharEncode(e);if(t.mime.startsWith("audio"))this.aplayerData.music.src=a,this.aplayerData.isBusy=!0;else if(t.mime.startsWith("video")){this.dplayerData.url=a;var o=t.name+".vtt";this.dplayerData.showVtt&&this.list.find((function(t){return t.name===o}))&&(this.dplayerData.vttUrl=this.dplayerData.url+".vtt"),this.dplayerData.title=t.name,this.dplayerData.isBusy=!0}else t.mime.startsWith("image")?(this.imgData.url=a,this.imgData.title=t.name,this.imgData.isBusy=!0):t.mime.startsWith("text")?(this.textData.url=a,this.textData.title=t.name,this.textData.isBusy=!0):this.$message("该格式不支持预览","p")},previewText:function(){var t=this,e=this.textData.url;this.textData.text="loading...",this.common.axios.get(e+"?json").then((function(a){t.textData.text="loading from: "+a.data.url,a.data.url.startsWith("?")?t.common.axios.get(e+a.data.url,{responseType:"text"}).then((function(e){t.textData.text=e.data})):t.common.axios.get(a.data.url,{withCredentials:!1,responseType:"text"}).then((function(e){t.textData.text=e.data}))})).catch((function(e){t.textData.text=e.message}))},genReadme:function(t){var e=this;this.$set(this.readmeData.map,t,"loading..."),this.common.axios.get(this.common.urlSpCharEncode(t)+"README.md?json").then((function(a){e.common.axios.get(a.data.url,{withCredentials:!1,responseType:"text"}).then((function(a){e.readmeData.map[t]=pt()(a.data)}))})).catch((function(a){e.readmeData.map[t]="loading failed:"+a.message}))},updateProxy:function(t){var e=this;this.common.axios.get("./admin/public/proxy?proxy="+encodeURIComponent(t)).then((function(){e.$message("set proxy: "+t,"i")}))},updateTarget:function(t){var e=this;this.common.axios(t+"/admin/public/site").then((function(t){e.siteinfo=t.data,e.siteinfo.proxy.unshift({text:"no proxy",value:""}),e.readmeData.text=pt()(t.data.site_readme)})).catch((function(t){e.siteinfo.proxy=[{text:"no proxy",value:""}],e.siteinfo.proxy_cookie="",e.$messgae("获取site信息失败: "+t.message,"d")}))}},computed:{navPathArr:function(){var t=this.nowPath,e="/",a=[];return t.split("/").forEach((function(t){t&&(e+=t,e+="/",a.push({path:t,href:e}))})),a},list:function(){var t=this.listCache[this.nowPath]||{list:[{type:3,name:this.loadingData.isBusy?"loading...":"loading failed",size:NaN,time:void 0,mime:""}]};return t.list},next:function(){var t=this.listCache[this.nowPath];return t&&(t=t.next),t},audioList:function(){var t=this,e=[];return this.list.forEach((function(a){0===a.type&&a.mime.startsWith("audio")&&e.push({title:a.name,src:t.common.p_h0+t.nowPath+a.name})})),e},readme:function(){return this.readmeData.map[this.nowPath]||this.readmeData.text}}}),ft=mt,ht=Object(O["a"])(ft,X,Z,!1,null,null,null),gt=ht.exports,vt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"container"},[a("div",{staticClass:"row justify-content-center mt-3"},[a("b-card",{staticClass:"col-md-5 p-0 mt-3",attrs:{header:"Login"}},[a("b-form",{on:{submit:function(e){return e.preventDefault(),t.submit(e)}}},[a("b-form-group",{attrs:{label:"UserName"}},[a("b-form-input",{ref:"name",attrs:{trim:""},model:{value:t.loginForm.username,callback:function(e){t.$set(t.loginForm,"username",e)},expression:"loginForm.username"}})],1),a("b-form-group",{attrs:{label:"Password"}},[a("b-form-input",{ref:"pass",attrs:{trim:"",type:"password"},model:{value:t.loginForm.password,callback:function(e){t.$set(t.loginForm,"password",e)},expression:"loginForm.password"}})],1),a("b-button",{attrs:{variant:"primary",type:"submit",disabled:t.loading}},[t._v(t._s(t.loading?"loading...":"LOGIN"))])],1)],1)],1)])},bt=[],_t={computed:{},data:function(){return{loginForm:{username:"",password:""},loading:!1}},methods:{submit:function(){var t=this;if(!this.loginForm.username||!this.loginForm.password)return this.$message("账号或密码为空!","d");var e=this;this.loading=!0,this.common.axios.post("./admin/public/login",this.loginForm).then((function(){t.loading=!1,e.$message("登录成功","i"),window.localStorage.setItem("loginTime",(new Date).valueOf()+3e5),e.$store.commit("loginSuccess"),e.$router.push({path:"/dashboard"})})).catch((function(a){t.loading=!1,a.response?e.$message(a.response.data.info,"d"):e.$message(a.message,"d")}))}}},wt=_t,xt=Object(O["a"])(wt,vt,bt,!1,null,null,null),yt=xt.exports,Dt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"container"},[a("b-card",{staticClass:"mt-3",attrs:{"no-body":""}},[a("b-card-header",[t._v("Dashboard")]),a("b-card-body",{staticClass:"row"},[a("div",{staticClass:"col-6",staticStyle:{display:"flex","justify-content":"center","flex-direction":"column","align-items":"center"}},[a("b-card-title",[t._v("createTime:"+t._s(t.getCTime))]),a("b-card-title",[t._v("initTime:"+t._s(t.getITime))])],1),a("div",{staticClass:"col-6"},[a("b-list-group",[a("b-list-group-item",{staticClass:"d-flex justify-content-between align-items-center"},[t._v(" normal "),a("b-badge",{attrs:{variant:"primary",pill:""}},[t._v(t._s(t.runInfo.normal))])],1),a("b-list-group-item",{staticClass:"d-flex justify-content-between align-items-center"},[t._v(" api "),a("b-badge",{attrs:{variant:"primary",pill:""}},[t._v(t._s(t.runInfo.api))])],1),a("b-list-group-item",{staticClass:"d-flex justify-content-between align-items-center"},[t._v(" admin "),a("b-badge",{attrs:{variant:"primary",pill:""}},[t._v(t._s(t.runInfo.admin))])],1)],1)],1)])],1),a("b-card",{staticClass:"mt-3",attrs:{"no-body":""}},[a("b-card-header",[t._v("DriveInfo")]),a("b-card-body",{staticClass:"p-0"},[a("b-table-simple",{attrs:{hover:"",outlined:"",responsive:""}},[a("b-thead",[a("b-tr",[a("b-th",[t._v("path")]),a("b-th",[t._v("funcName")]),a("b-th",[t._v("password")])],1)],1),a("b-tbody",t._l(t.drivesInfos,(function(e){return a("b-tr",{key:e.path},[a("b-td",[t._v(t._s(e.path))]),a("b-td",[t._v(t._s(e.funcName))]),a("b-td",[e.password?[t._v(" "+t._s(e.password)+" "),a("b-dropdown",{attrs:{size:"lg",variant:"link","toggle-class":"p-0","no-caret":""},scopedSlots:t._u([{key:"button-content",fn:function(){return[a("b-icon",{attrs:{icon:"reply","aria-hidden":"true"}}),a("span",{staticClass:"sr-only"},[t._v("Share")])]},proxy:!0}],null,!0)},[a("b-dropdown-text",[t._v("Share it")]),a("b-dropdown-divider"),a("b-dropdown-item",{on:{click:function(a){return t.getShareUrl(e.path,864e5,e.password)}}},[t._v("1天")]),a("b-dropdown-item",{on:{click:function(a){return t.getShareUrl(e.path,2592e5,e.password)}}},[t._v("3天")]),a("b-dropdown-item",{on:{click:function(a){return t.getShareUrl(e.path,6048e5,e.password)}}},[t._v("7天")])],1)]:a("span",[t._v("none")])],2)],1)})),1)],1),a("p",{staticClass:"text-center"},[a("a",{attrs:{href:t.info}},[t._v(t._s(t.info))])])],1)],1)],1)},kt=[],Ct={name:"Dashboard",data:function(){return{runInfo:{},drivesInfos:[],info:"#Share the drives with your friends"}},created:function(){var t=this;this.common.axios.get("./admin/ajax/dashboard").then((function(e){console.log(e.data),t.runInfo=e.data.runInfo,t.drivesInfos=e.data.drivesInfos}))},methods:{getShareUrl:function(t,e){var a=this;e=(new Date).valueOf()+e,a.info="loading...",a.common.axios.get("./admin/ajax/share",{params:{path:t,time:e}}).then((function(t){console.log(t.data),a.info=a.common.p_h0+t.data.url}))}},computed:{getCTime:function(){return this.common.formatDate(this.runInfo.createTime)},getITime:function(){return this.common.formatDate(this.runInfo.initTime)}},components:{}},Pt=Ct,St=Object(O["a"])(Pt,Dt,kt,!1,null,null,null),$t=St.exports,Nt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"container mt-3"},[a("b-breadcrumb",[a("b-breadcrumb-item",{on:{click:function(e){return t.chwd("/")}}},[a("b-icon",{attrs:{icon:"house-fill",scale:"1.25","shift-v":"1.25","aria-hidden":"true"}}),t._v("Home ")],1),t._l(t.navPathArr,(function(e){return a("b-breadcrumb-item",{key:e.href,on:{click:function(a){return t.chwd(e.href)}}},[t._v(t._s(e.path))])}))],2),a("div",{staticClass:"mt-3"},[a("b-dropdown",{attrs:{text:"Options",variant:"outline-primary"}},[a("b-dropdown-item",{directives:[{name:"b-modal",rawName:"v-b-modal.modal-touch",modifiers:{"modal-touch":!0}}]},[t._v("New File")]),a("b-dropdown-item",{on:{click:function(e){return t.optBtnClick("mkdir")}}},[t._v("New Folder")]),a("b-dropdown-divider"),a("b-dropdown-item",{on:{click:function(e){return t.uploadBtnClick("upload-files")}}},[t._v("Upload File")]),a("b-dropdown-item",{on:{click:function(e){return t.uploadBtnClick("upload-folder")}}},[t._v("Upload Folder")])],1),a("b-button",{staticClass:"ml-2",on:{click:function(e){return t.updateList()}}},[t._v("Sync")]),a("b-button",{directives:[{name:"show",rawName:"v-show",value:t.nextToken,expression:"nextToken"}],staticClass:"ml-2",on:{click:function(e){return t.updateList(t.nowPath,t.nextToken)}}},[t._v("LoadNext")]),a("b-button",{directives:[{name:"show",rawName:"v-show",value:t.uploadData.uploadNow||t.uploadData.uploadQueue.length||t.uploadData.uploadSucess.length||t.uploadData.uploadFail.length,expression:"uploadData.uploadNow || uploadData.uploadQueue.length || uploadData.uploadSucess.length || uploadData.uploadFail.length"},{name:"b-modal",rawName:"v-b-modal.modal-upload",modifiers:{"modal-upload":!0}}],staticClass:"ml-2"},[t._v("Upload Status")]),a("b-button",{directives:[{name:"show",rawName:"v-show",value:"mv"===t.cmdType&&t.srcPath,expression:"('mv' === cmdType) && srcPath"}],staticClass:"ml-2",attrs:{variant:"primary",title:t.srcPath},on:{click:function(e){return t.optBtnClick("mv")}}},[t._v("MoveTo")]),a("b-button",{directives:[{name:"show",rawName:"v-show",value:"cp"===t.cmdType&&t.srcPath,expression:"('cp' === cmdType) && srcPath"}],staticClass:"ml-2",attrs:{variant:"primary",title:t.srcPath},on:{click:function(e){return t.optBtnClick("cp")}}},[t._v("Paste")]),a("b-button",{directives:[{name:"show",rawName:"v-show",value:t.srcPath,expression:"srcPath"}],staticClass:"ml-2",attrs:{variant:"primary"},on:{click:function(e){t.srcPath=""}}},[t._v("Cancel")]),a("span",{directives:[{name:"show",rawName:"v-show",value:t.loadingbarData.show,expression:"loadingbarData.show"}]},[a("span",{staticClass:"mx-3"},[t._v(t._s(t.loadingbarData.info))]),a("b-spinner",{staticClass:"float-right",attrs:{variant:"primary",label:"Spinning"}})],1)],1),a("b-table",{staticClass:"border rounded mt-2",attrs:{hover:"",responsive:"",id:"list-table",items:t.list,fields:t.fields,busy:t.loadingData.isBusy,"primary-key":"nameFormat","head-variant":"light","per-page":t.pageData.perPage,"current-page":t.pageData.currentPage},scopedSlots:t._u([{key:"cell(nameFormat)",fn:function(e){return[a("div",{staticClass:"opt-div"},[a("b-icon",{staticClass:"opt-icon",attrs:{icon:"command",scale:"1.25","shift-v":"1.25","shift-h":"-3","aria-hidden":"true"}}),a("div",{staticClass:"opt-btns"},[a("b-button-group",{attrs:{vertical:""}},[a("b-button",{on:{click:function(a){return t.optBtnClick("rm",e.item.name)}}},[t._v("Delete")]),a("b-button",{on:{click:function(a){return t.optBtnClick("ren",e.item.name)}}},[t._v("Rename")]),a("b-button",{on:{click:function(a){return t.optBtnClick("mv_",e.item.name)}}},[t._v("Move")]),a("b-button",{on:{click:function(a){return t.optBtnClick("cp_",e.item.name)}}},[t._v("Copy")]),e.item.type?t._e():a("b-button",{on:{click:function(a){return t.downloadNow(e.item.name)}}},[t._v("Download")])],1)],1)],1),e.item.type?a("a",{attrs:{href:"#"},on:{click:function(a){return t.chwd(e.item.name+"/")}}},[t._v(t._s(e.item.name)+"/")]):a("span",[t._v(t._s(e.item.name))])]}},{key:"table-busy",fn:function(){return[a("div",{staticClass:"text-center text-primary my-2"},[a("b-spinner",{staticClass:"align-middle"}),a("strong",[t._v(t._s(t.loadingData.info))])],1)]},proxy:!0}])}),a("div",{staticClass:"overflow-auto",staticStyle:{display:"flex","justify-content":"flex-end"}},[a("b-pagination",{attrs:{"total-rows":t.list.length,"per-page":t.pageData.perPage,"aria-controls":"list-table"},model:{value:t.pageData.currentPage,callback:function(e){t.$set(t.pageData,"currentPage",e)},expression:"pageData.currentPage"}}),a("b-form-select",{staticClass:"mb-3 ml-2",staticStyle:{width:"100px"},attrs:{options:t.pageData.pageOptions},model:{value:t.pageData.perPage,callback:function(e){t.$set(t.pageData,"perPage",e)},expression:"pageData.perPage"}})],1),a("div",{staticClass:"fixed-bottom"},[a("b-alert",{attrs:{show:t.alertData.dismissCountDown,dismissible:"",fade:"",variant:t.alertData.type},on:{"dismiss-count-down":t.countDownChanged}},[t._v(t._s(t.alertData.info))])],1),a("b-modal",{attrs:{id:"modal-touch",size:"lg",title:"touch a new file"},on:{ok:function(e){return t.optBtnClick("touch")}}},[a("form",{ref:"form-touch",on:{submit:function(t){t.stopPropagation(),t.preventDefault()}}},[a("b-form-group",{attrs:{label:"file name:"}},[a("b-form-input",{model:{value:t.uploadData.uploadTouch.name,callback:function(e){t.$set(t.uploadData.uploadTouch,"name",e)},expression:"uploadData.uploadTouch.name"}})],1),a("b-form-group",{attrs:{label:"file content:"}},[a("b-form-textarea",{attrs:{placeholder:"here is the file content",rows:"8","max-rows":"16"},model:{value:t.uploadData.uploadTouch.content,callback:function(e){t.$set(t.uploadData.uploadTouch,"content",e)},expression:"uploadData.uploadTouch.content"}})],1)],1)]),a("b-modal",{attrs:{id:"modal-upload",size:"lg",title:"upload status",scrollable:"","hide-footer":"","hide-header":""}},[a("div",{staticClass:"container"},[t.uploadData.uploadNow?a("div",[a("p",{staticClass:"text-primary"},[t._v("now")]),t._v(" "+t._s(t.uploadData.uploadNow.file.name)+" "),a("b-progress",{attrs:{value:t.uploadData.uploadSize,max:t.uploadData.uploadNow.file.size,"show-progress":"",animated:""}})],1):t._e(),a("p",{staticClass:"text-secondary"},[t._v("waiting")]),t._l(t.uploadData.uploadQueue,(function(e){return a("p",{key:e.path+e.file.name},[t._v(" "+t._s(e.file.name)+" -- "+t._s(t.common.formatSize(e.file.size))+" -- "+t._s(e.path)+" ")])})),a("p",{staticClass:"text-danger"},[t._v("fail")]),t._l(t.uploadData.uploadFail,(function(e){return a("p",{key:e.path+e.file.name},[a("a",{attrs:{href:"#"},on:{click:function(a){return a.preventDefault(),t.retryUpload(e)}}},[a("b-icon-arrow-clockwise")],1),t._v(" "+t._s(e.file.name)+" -- "+t._s(t.common.formatSize(e.file.size))+" -- "+t._s(e.path)+" ")])})),a("p",{staticClass:"text-success"},[t._v("success")]),t._l(t.uploadData.uploadSucess,(function(e){return a("p",{key:e.path+e.file.name},[t._v(" "+t._s(e.file.name)+" -- "+t._s(t.common.formatSize(e.file.size))+" -- "+t._s(e.path)+" ")])}))],2)]),a("input",{ref:"upload-files",staticClass:"d-none",attrs:{type:"file",multiple:""},on:{change:t.uploadOnChange}}),a("input",{ref:"upload-folder",staticClass:"d-none",attrs:{type:"file",webkitdirectory:""},on:{change:t.uploadOnChange}})],1)},Tt=[],Ot=(a("4de4"),a("baa5"),a("a434"),a("8a79"),{data:function(){return{nowPath:"/",list:[],nextToken:"",listCache:{},pageData:{currentPage:1,perPage:10,pageOptions:[{text:"10/Page",value:10},{text:"50/Page",value:50}]},srcPath:"",cmdType:"",uploadData:{uploadQueue:[],uploadSucess:[],uploadFail:[],uploadNow:null,uploadSize:0,uploadTouch:{name:"",content:""}},searchData:{text:"",parentPath:"",content:[]},loadingbarData:{show:!1,info:"default info"},loadingData:{isBusy:!1,info:"default info"},alertData:{dismissCountDown:0,type:"primary",info:"default info"},fields:[{key:"nameFormat",label:"Name"},{key:"time",label:"Time",thStyle:"width:180px",class:"d-none d-md-table-cell",formatter:this.common.formatDate},{key:"size",label:"Size",thStyle:"width:120px",class:"text-right mr-3 d-none d-md-table-cell",formatter:this.common.formatSize}]}},created:function(){this.updateList()},methods:{chwd:function(t){t.startsWith("/")?this.updateList(t):this.updateList(this.nowPath+t)},loadNextContent:function(t){console.log(t)},updateList:function(t,e){var a,o=this;return t||(t=this.nowPath,a=!0),!this.listCache[t]||a||e?this.loadingData.isBusy?this.showAlert("Processing other tasks, try again later","w"):(this.loadingData.isBusy=!0,this.loadingData.info="loading... "+t,console.log("try: ls "+t+(e?"?spPage="+e:"")),void this.common.axios.post("./api/cmd",{cmdType:"ls",cmdData:{path:t,spPage:e}}).then((function(a){o.loadingData.isBusy=!1,console.log(a.data),a.data.list?(o.nowPath=t,e?(a.data.list.forEach((function(e){return o.listCache[t].list.push(e)})),o.listCache[t].nextToken=a.data.nextToken):o.listCache[t]=a.data,o.list=o.listCache[t].list,o.nextToken=a.data.nextToken):console.log(a.data)})).catch((function(t){o.loadingData.isBusy=!1,console.log(t),void 0!==t.response?401===t.response.status?o.$router.push({path:"/login"}):o.showAlert("error: "+t.response.data.info,"d"):o.showAlert("error: "+t.message,"d")}))):(this.list=this.listCache[t].list,this.nextToken=this.listCache[t].nextToken,void(this.nowPath=t))},sendCmd:function(t,e){var a=this,o=this,i=n();function n(){switch(t){case"mkdir":return"mkdir "+e.path+e.name;case"mv":case"cp":return t+" "+e.srcPath+" "+e.desPath;case"rm":return"rm "+e.path;case"ren":return"ren "+e.path+" "+e.name;case"touch":case"upload":return t+" "+e.path+(e.name||"");case"find":return t+" "+e.path+" "+e.text;default:return"unknown: "+t}}function s(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";t.endsWith("/")&&(t=t.slice(0,-1));var e=t.lastIndexOf("/")+1;return{path:t.slice(0,e),name:t.slice(e)}}console.log("try: "+i),this.loadingbarData.info=i,this.loadingbarData.show=!0,this.common.axios.post("./api/cmd",{cmdType:t,cmdData:e}).then((function(i){var n,r,l,c;switch(a.loadingbarData.show=!1,t){case"mkdir":return void o.listCache[e.path].list.unshift({type:1,name:e.name,size:0,mime:"",time:o.common.formatDate(new Date)});case"mv":case"cp":return n=s(e.srcPath),r=-1,l=o.listCache[n.path].list.find((function(t,e){return r=e,t.name===n.name})),"mv"===t&&o.listCache[n.path].list.splice(r,1),void o.listCache[e.desPath].list.unshift(l);case"rm":case"ren":return n=s(e.path),r=-1,l=o.listCache[n.path].list.find((function(t,e){return r=e,t.name===n.name})),void("rm"===t?o.listCache[n.path].list.splice(r,1):l.name=e.name);case"touch":return void o.listCache[e.path].list.unshift({type:0,name:e.name,size:o.common.formatSize(e.content.length),mime:"onepoint/unknown",time:o.common.formatDate(new Date)});case"upload":return c=i.data.json.uploadUrl,void o.common.axios.get(c,{withCredentials:!1}).then((function(t){o.fileUpload(t.data,c)}));case"find":return o.nowPath=i.data.parentPath,void(o.content=i.data.data.content);default:return void console.log("unknown: "+t)}})).catch((function(e){o.loadingbarData.show=!1,console.log(e),void 0!==e.response?o.showAlert("error: "+e.response.data.info,"d"):o.showAlert("error: "+e.message,"d"),"upload"===t&&o.uploadData.uploadNow&&(o.uploadData.uploadFail.unshift(o.uploadData.uploadNow),o.uploadData.uploadNow=null)}))},optBtnClick:function(t){var e,a=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=this.nowPath+o,n=this;switch(t){case"mkdir":return void this.$prompt({title:"mkdir",message:"make dir in: "+i,ok:function(e){n.sendCmd(t,{path:i,name:e})}});case"mv_":return this.cmdType="mv",void(this.srcPath=i);case"mv":if(!this.srcPath||this.srcPath.slice(0,this.srcPath.lastIndexOf("/")+1)===this.nowPath)return;return void this.$confirm({title:"mv",message:"move :"+this.srcPath+" -> "+this.nowPath,ok:function(){n.sendCmd(t,{srcPath:a.srcPath,desPath:a.nowPath}),n.srcPath=""}});case"cp_":return this.cmdType="cp",void(this.srcPath=i);case"cp":if(!this.srcPath||this.srcPath.slice(0,this.srcPath.lastIndexOf("/")+1)===this.nowPath)return;return void this.$confirm({title:"cp",message:"copy :"+this.srcPath+" -> "+this.nowPath,ok:function(){n.sendCmd(t,{srcPath:a.srcPath,desPath:a.nowPath}),n.srcPath=""}});case"rm":return void this.$confirm({title:"rm",message:"remove: "+i,ok:function(){n.sendCmd(t,{path:i})}});case"ren":return void this.$prompt({title:"ren",message:"rename: "+i,ok:function(e){n.sendCmd(t,{path:i,name:e})}});case"touch":if(!this.uploadData.uploadTouch.name)return;return this.sendCmd(t,{path:this.nowPath,name:this.uploadData.uploadTouch.name,content:this.uploadData.uploadTouch.content||""}),this.uploadData.uploadTouch.name="",void(this.uploadData.uploadTouch.content="");case"upload":if(this.uploadData.uploadNow||0===this.uploadData.uploadQueue.length)return;return this.uploadData.uploadNow=this.uploadData.uploadQueue.shift(),e=this.uploadData.uploadNow,void this.sendCmd(t,{path:e.path+e.file.name,fileSystemInfo:{lastModifiedDateTime:e.file.lastModifiedDate.toISOString()}});case"find":return void this.sendCmd(t,{path:this.nowPath,text:this.searchData.text});default:return void console.log("err: "+t)}},showAlert:function(t,e){this.alertData.dismissCountDown=5,this.alertData.type={i:"info",d:"danger",s:"success",w:"warning"}[e]||"primary",this.alertData.info=t},countDownChanged:function(t){this.alertData.dismissCountDown=t},uploadBtnClick:function(t){this.$refs[t].click()},uploadOnChange:function(t){console.log(t.target.files);for(var e=t.target.files,a=0;a<e.length;a++)this.uploadData.uploadQueue.push({path:this.nowPath,file:e[a],time:new Date})},fileUpload:function(t,e){var a,o,i,n,s=this;n=this.uploadData.uploadNow.file;var r=t.nextExpectedRanges[0].split("-");a=Number(r[0]),o=r[1]?Number(r[1])+1:n.size,i=e||t.uploadUrl,o>a+10485760&&(o=a+10485760);var l=new FileReader;l.readAsArrayBuffer(n.slice(a,o)),l.onload=function(e){console.log("send: ["+a+","+o+")"),s.common.axios.put(i,e.target.result,{headers:{"Content-Range":"bytes ".concat(a,"-").concat(o-1,"/").concat(n.size)},onUploadProgress:function(t){var e=t.loaded;s.uploadData.uploadSize=a+e},withCredentials:!1}).then((function(e){if(console.log(e.data),console.log("success: ["+a+","+o+")"),201===e.status)return s.listCache[s.uploadData.uploadNow.path].list.unshift({type:0,name:s.uploadData.uploadNow.file.name,size:s.common.formatSize(s.uploadData.uploadNow.file.size),mime:"onepoint/unknown",time:s.common.formatDate(s.uploadData.uploadNow.file.lastModifiedDate)}),s.showAlert("success: upload"+s.uploadData.uploadNow.file.name,"i"),console.log("success: "+JSON.stringify(t)),s.uploadData.uploadSucess.push(s.uploadData.uploadNow),void(s.uploadData.uploadNow=null);if(202!==e.status)throw e;s.fileUpload(e.data,i)})).catch((function(t){console.log(t),s.showAlert("error: "+t.message,"d"),s.uploadData.uploadNow&&(console.error("fail: upload "+n.name),s.uploadData.uploadFail.unshift(s.uploadData.uploadNow),s.uploadData.uploadNow=null)}))}},retryUpload:function(t){console.log(t),this.uploadData.uploadFail=this.uploadData.uploadFail.filter((function(e){return e!==t})),this.uploadData.uploadQueue.push(t)},downloadNow:function(t){window.open(this.common.p_h0+this.nowPath+t,"_blank")}},computed:{navPathArr:function(){var t=this.nowPath,e="/",a=[];return t.split("/").forEach((function(t){t&&(e+=t,e+="/",a.push({path:t,href:e}))})),a}},beforeUpdate:function(){this.uploadData.uploadNow||this.optBtnClick("upload")}}),jt=Ot,Bt=(a("f50a"),Object(O["a"])(jt,Nt,Tt,!1,null,null,null)),Ft=Bt.exports,It=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"container mt-3"},[a("b-form-input",{attrs:{placeholder:"Search"},model:{value:t.keyText,callback:function(e){t.keyText="string"===typeof e?e.trim():e},expression:"keyText"}}),a("b-table",{staticClass:"border rounded mt-3",attrs:{hover:"",responsive:"",items:t.cacheFilter,fields:t.fields,"head-variant":"light","per-page":t.perPage,"current-page":t.currentPage}}),a("div",{staticClass:"overflow-auto",staticStyle:{display:"flex","justify-content":"flex-end"}},[a("b-pagination",{attrs:{"total-rows":t.cacheFilter.length,"per-page":t.perPage},model:{value:t.currentPage,callback:function(e){t.currentPage=e},expression:"currentPage"}}),a("b-form-select",{staticClass:"mb-3 ml-2",staticStyle:{width:"100px"},attrs:{options:t.pageOptions},model:{value:t.perPage,callback:function(e){t.perPage=e},expression:"perPage"}})],1)],1)},Et=[],zt=(a("caad"),a("b64b"),a("2532"),{data:function(){return{cache:[],keyText:"",fields:[{key:"name",formatter:function(t){return t||"------not cached------"}},"path"],currentPage:1,perPage:10,pageOptions:[{text:"10/Page",value:10},{text:"50/Page",value:50}]}},beforeCreate:function(){var t=this,e=this;this.common.axios.get("./admin/ajax/cache").then((function(e){t.updateCache(e.data.root,"/")})).catch((function(t){e.cache.push({name:"error",path:t})}))},methods:{updateCache:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],a=arguments.length>1?arguments[1]:void 0,o=this.cache;e.forEach((function(e){if(e)if("string"===typeof e)o.push({name:e,path:a});else{var i=Object.keys(e)[0];o.push({name:i,path:a}),e[i]?t.updateCache(e[i],a+i+"/"):o.push({name:"",path:a+i+"/"})}else o.push({name:"",path:a})}))}},computed:{cacheFilter:function(){var t=this;return this.keyText?this.cache.filter((function(e){return e.name.includes(t.keyText)||e.path.includes(t.keyText)})):this.cache}}}),Mt=zt,Ut=Object(O["a"])(Mt,It,Et,!1,null,null,null),Lt=Ut.exports,At=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"container"},[a("div",{staticClass:"mt-3"},[a("router-view")],1)])},Vt=[],Rt={},Gt=Rt,Jt=Object(O["a"])(Gt,At,Vt,!1,null,null,null),Wt=Jt.exports,Ht=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("b-card",{attrs:{"no-body":""}},[a("b-card-header",[t._v("网站信息")]),a("b-card-body",{staticClass:"row"},[a("div",{staticClass:"container"},[a("b-form-group",{attrs:{label:"网站名称"}},[a("b-form-input",{model:{value:t.g_config.site_name,callback:function(e){t.$set(t.g_config,"site_name",e)},expression:"g_config.site_name"}})],1),a("b-form-group",{attrs:{label:"网站图标"}},[a("b-form-input",{attrs:{type:"url"},model:{value:t.g_config.site_icon,callback:function(e){t.$set(t.g_config,"site_icon",e)},expression:"g_config.site_icon"}}),a("b-form-text",[t._v("示例：https://example.com/favicon.png")])],1),a("b-form-group",{attrs:{label:"网站标题"}},[a("b-form-input",{model:{value:t.g_config.site_title,callback:function(e){t.$set(t.g_config,"site_title",e)},expression:"g_config.site_title"}})],1),a("b-form-group",{attrs:{label:"网站关键字"}},[a("b-form-input",{model:{value:t.g_config.site_keywords,callback:function(e){t.$set(t.g_config,"site_keywords",e)},expression:"g_config.site_keywords"}})],1),a("b-form-group",{attrs:{label:"网站描述"}},[a("b-form-textarea",{attrs:{rows:"3"},model:{value:t.g_config.site_description,callback:function(e){t.$set(t.g_config,"site_description",e)},expression:"g_config.site_description"}})],1),a("b-form-group",{attrs:{label:"全站脚本"}},[a("b-form-textarea",{attrs:{rows:"3"},model:{value:t.g_config.site_script,callback:function(e){t.$set(t.g_config,"site_script",e)},expression:"g_config.site_script"}}),a("b-form-text",[t._v("示例：<script>console.log('js');<\/script>")])],1),a("b-form-group",{attrs:{label:"网站公告"}},[a("b-form-textarea",{attrs:{rows:"10","max-rows":"50"},model:{value:t.g_config.site_readme,callback:function(e){t.$set(t.g_config,"site_readme",e)},expression:"g_config.site_readme"}}),a("b-form-text",[t._v("markdown格式")])],1),a("b-button",{staticStyle:{"min-width":"80px"},attrs:{href:"#",variant:"primary",disabled:t.waiting},on:{click:t.save}},[t._v(t._s(t.waiting?"提交中":"保存"))])],1)])],1)},Qt=[],qt={data:function(){return{waiting:!1,g_config:{site_name:"xx",site_icon:"xx",site_title:"xx",site_keywords:"xx",site_description:"xx",site_script:"xx",site_readme:"xx"}}},created:function(){var t=this;this.common.axios.get("./admin/ajax/setting/site").then((function(e){t.g_config=e.data.G_CONFIG})).catch((function(e){t.g_config.site_name="error: "+e.message}))},methods:{save:function(){var t=this;this.waiting=!0,this.common.axios.post("./admin/ajax/save",{G_CONFIG:this.g_config}).then((function(e){t.waiting=!1,alert(e.data.info)})).catch((function(e){t.waiting=!1,console.log(e),alert("failed")}))}}},Kt=qt,Yt=Object(O["a"])(Kt,Ht,Qt,!1,null,null,null),Xt=Yt.exports,Zt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("b-card",{attrs:{"no-body":""}},[a("b-card-header",[t._v("云盘挂载")]),a("b-card-body",[a("b-table-simple",{attrs:{hover:"",responsive:""}},[a("b-thead",[a("b-tr",[a("b-th",[t._v("path")]),a("b-th",[t._v("funcName")]),a("b-th",[t._v("password")]),a("b-th",[t._v("spConfig")])],1)],1),a("b-tbody",t._l(t.drive_map,(function(e){return a("b-tr",{key:e.path},[a("b-td",[t._v(t._s(e.path))]),a("b-td",[t._v(t._s(e.funcName))]),a("b-td",[e.password?[t._v(t._s(e.password))]:a("span",[t._v("none")])],2),a("b-td",[a("b-icon",{staticStyle:{cursor:"pointer"},attrs:{icon:"info-circle",scale:"1.25",variant:"primary"},on:{click:function(a){return t.showDriveInfo(e.path)}}}),a("b-icon",{staticStyle:{cursor:"pointer","margin-left":"8px"},attrs:{icon:"x-circle",scale:"1.25",variant:"primary"},on:{click:function(a){return t.removeDrive(e.path)}}})],1)],1)})),1)],1),a("b-button",{directives:[{name:"b-modal",rawName:"v-b-modal.drive-add-modal",modifiers:{"drive-add-modal":!0}}],staticStyle:{"min-width":"80px"},attrs:{variant:"primary",disabled:t.waiting}},[t._v("添加")]),a("b-button",{staticClass:"ml-3",staticStyle:{"min-width":"80px"},attrs:{href:"#",variant:"primary",disabled:t.waiting},on:{click:t.save}},[t._v(t._s(t.waiting?"提交中":"保存"))])],1),a("b-modal",{attrs:{id:"drive-add-modal",centered:"","hide-footer":"",title:"Add New Drive",size:"xl"}},[a("div",[a("div",{staticClass:"d-flex"},[a("b-form-group",{staticClass:"col-4",attrs:{label:"映射路径"}},[a("b-form-input",{model:{value:t.tmp_config.path,callback:function(e){t.$set(t.tmp_config,"path",e)},expression:"tmp_config.path"}})],1),a("b-form-group",{staticClass:"col-4",attrs:{label:"云盘密码"}},[a("b-form-input",{model:{value:t.tmp_config.password,callback:function(e){t.$set(t.tmp_config,"password",e)},expression:"tmp_config.password"}})],1),a("b-form-group",{staticClass:"col-4",attrs:{label:"模块类型"}},[a("b-form-select",{attrs:{options:t.funcNames},model:{value:t.selected,callback:function(e){t.selected=e},expression:"selected"}})],1)],1),a("hr"),a("div",{directives:[{name:"show",rawName:"v-show",value:"onedrive_graph"===t.selected,expression:"selected==='onedrive_graph'"}]},[a("div",{staticClass:"d-flex"},[a("b-form-group",{staticClass:"col-4",attrs:{label:"根路径(root)"}},[a("b-form-input",{model:{value:t.tmp_config.onedrive_graph.root,callback:function(e){t.$set(t.tmp_config.onedrive_graph,"root",e)},expression:"tmp_config.onedrive_graph.root"}})],1),a("b-form-group",{staticClass:"col-4",attrs:{label:"认证类型(默认为0,世纪互联为1)"}},[a("b-form-input",{model:{value:t.tmp_config.onedrive_graph.oauth,callback:function(e){t.$set(t.tmp_config.onedrive_graph,"oauth",e)},expression:"tmp_config.onedrive_graph.oauth"}})],1),a("b-form-group",{staticClass:"col-4",attrs:{label:"获取令牌"}},[a("a",{staticClass:"btn btn-secondary d-block",attrs:{href:"https://point.onesrc.cn/oauth2/",target:"blank"}},[t._v("GetToken")])])],1),a("b-form-group",{staticClass:"col-12",attrs:{label:"认证令牌(refresh_token)"}},[a("b-form-textarea",{attrs:{rows:"3","max-rows":"8"},model:{value:t.tmp_config.onedrive_graph.refresh_token,callback:function(e){t.$set(t.tmp_config.onedrive_graph,"refresh_token",e)},expression:"tmp_config.onedrive_graph.refresh_token"}})],1)],1),a("div",{directives:[{name:"show",rawName:"v-show",value:"onedrive_sharepoint"===t.selected,expression:"selected==='onedrive_sharepoint'"}]},[a("div",{staticClass:"d-flex"},[a("b-form-group",{staticClass:"col-4",attrs:{label:"根路径"}},[a("b-form-input",{model:{value:t.tmp_config.onedrive_sharepoint.root,callback:function(e){t.$set(t.tmp_config.onedrive_sharepoint,"root",e)},expression:"tmp_config.onedrive_sharepoint.root"}})],1),a("b-form-group",{staticClass:"col-8",attrs:{label:"分享链接"}},[a("b-form-input",{attrs:{type:"url"},model:{value:t.tmp_config.onedrive_sharepoint.shareUrl,callback:function(e){t.$set(t.tmp_config.onedrive_sharepoint,"shareUrl",e)},expression:"tmp_config.onedrive_sharepoint.shareUrl"}})],1)],1)]),a("div",{directives:[{name:"show",rawName:"v-show",value:"gdrive_goindex"===t.selected,expression:"selected==='gdrive_goindex'"}]},[a("div",{staticClass:"d-flex"},[a("b-form-group",{staticClass:"col-4",attrs:{label:"goindex密码"}},[a("b-form-input",{model:{value:t.tmp_config.gdrive_goindex.password,callback:function(e){t.$set(t.tmp_config.gdrive_goindex,"password",e)},expression:"tmp_config.gdrive_goindex.password"}})],1),a("b-form-group",{staticClass:"col-8",attrs:{label:"cloudflare链接"}},[a("b-form-input",{attrs:{type:"url"},model:{value:t.tmp_config.gdrive_goindex.cfurl,callback:function(e){t.$set(t.tmp_config.gdrive_goindex,"cfurl",e)},expression:"tmp_config.gdrive_goindex.cfurl"}})],1)],1)]),a("div",{directives:[{name:"show",rawName:"v-show",value:"linux_scf"===t.selected,expression:"selected==='linux_scf'"}]},[a("div",{staticClass:"d-flex"},[a("b-form-group",{staticClass:"col-4",attrs:{label:"根路径"}},[a("b-form-input",{model:{value:t.tmp_config.linux_scf.root,callback:function(e){t.$set(t.tmp_config.linux_scf,"root",e)},expression:"tmp_config.linux_scf.root"}})],1)],1)]),a("div",{directives:[{name:"show",rawName:"v-show",value:"system_phony"===t.selected,expression:"selected==='system_phony'"}]},[a("div",{staticClass:"d-flex"},[a("b-form-group",{staticClass:"col-12",attrs:{label:"文件链接"}},[a("b-form-textarea",{attrs:{rows:"3","max-rows":"8",disabled:""},model:{value:t.tmp_config.system_phony.list,callback:function(e){t.$set(t.tmp_config.system_phony,"list",e)},expression:"tmp_config.system_phony.list"}})],1)],1)]),a("hr"),a("b-button",{staticClass:"mx-3",attrs:{disabled:!t.selected||!t.tmp_config.path,variant:"primary"},on:{click:t.addNewDrive}},[t._v("确认添加")])],1)]),a("b-modal",{attrs:{id:"drive-modal",centered:"","hide-footer":"",title:"DriveInfo",size:"xl"}},[a("pre",[a("code",[t._v(t._s(t.driveInfo))])])])],1)},te=[],ee={data:function(){return{waiting:!1,drive_map:[{path:"none"}],driveInfo:"no drive",funcNames:["onedrive_graph","onedrive_sharepoint","gdrive_goindex","linux_scf","system_phony"],selected:"",tmp_config:{path:"",onedrive_graph:{root:"",refresh_token:"",oauth:0},onedrive_sharepoint:{root:"",shareUrl:""},gdrive_goindex:{cfurl:"",password:""},linux_scf:{root:""},system_phony:{list:""},password:""}}},created:function(){var t=this;this.common.axios.get("./admin/ajax/setting/drives").then((function(e){t.drive_map=e.data.DRIVE_MAP})).catch((function(e){t.drive_map=[{path:"error: "+e.message}]}))},methods:{showDriveInfo:function(t){var e=this.drive_map.find((function(e){return e.path===t}))||"no such drive";this.driveInfo=JSON.stringify(e,null,2),this.$bvModal.show("drive-modal")},removeDrive:function(t){this.drive_map=this.drive_map.filter((function(e){return e.path!==t}))},addNewDrive:function(){var t=this;if(!this.tmp_config.path.endsWith("/"))return this.$message("格式有误,例如 /images/ ","w");var e=this.drive_map.find((function(e){return e.path===t.tmp_config.path}));if(e)return this.$message("该云盘已存在","w");var a={path:this.tmp_config.path,funcName:this.selected,spConfig:JSON.parse(JSON.stringify(this.tmp_config[this.selected])),password:this.tmp_config.password,isNew:!0};this.drive_map.push(a),console.log(JSON.stringify(a)),this.$message("添加成功","s"),this.$bvModal.hide("drive-add-modal")},save:function(){var t=this;this.waiting=!0;var e=JSON.parse(JSON.stringify(this.drive_map)),a={};e.forEach((function(t){a[t.path]=t,delete t.path})),this.common.axios.post("./admin/ajax/save",{DRIVE_MAP:a}).then((function(e){t.waiting=!1,alert(e.data.info)})).catch((function(e){t.waiting=!1,console.log(e),alert("failed")}))}}},ae=ee,oe=Object(O["a"])(ae,Zt,te,!1,null,null,null),ie=oe.exports,ne=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("b-card",{attrs:{"no-body":""}},[a("b-card-header",[t._v("密码设置")]),a("b-card-body",[a("b-form-group",{attrs:{label:"旧密码"}},[a("b-form-input",{attrs:{type:"password"},model:{value:t.g_config.admin_password_old,callback:function(e){t.$set(t.g_config,"admin_password_old",e)},expression:"g_config.admin_password_old"}})],1),a("b-form-group",{attrs:{label:"新账户名"}},[a("b-form-input",{model:{value:t.g_config.admin_username,callback:function(e){t.$set(t.g_config,"admin_username",e)},expression:"g_config.admin_username"}})],1),a("b-form-group",{attrs:{label:"新密码"}},[a("b-form-input",{attrs:{type:"password"},model:{value:t.g_config.admin_password,callback:function(e){t.$set(t.g_config,"admin_password",e)},expression:"g_config.admin_password"}})],1),a("b-form-group",{attrs:{label:"重复新密码"}},[a("b-form-input",{attrs:{type:"password"},model:{value:t.g_config.admin_password1,callback:function(e){t.$set(t.g_config,"admin_password1",e)},expression:"g_config.admin_password1"}})],1),a("b-button",{staticStyle:{"min-width":"80px"},attrs:{href:"#",variant:"primary",disabled:t.waiting},on:{click:t.save}},[t._v(t._s(t.waiting?"提交中":"保存"))])],1)],1)},se=[],re={data:function(){return{waiting:!1,g_config:{admin_password_old:"",admin_username:"",admin_password:"",admin_password1:""}}},methods:{save:function(){var t=this,e=this;return e.g_config.admin_password!==e.g_config.admin_password1?e.$message("两次密码不一致","w"):e.g_config.admin_username&&e.g_config.admin_password?(this.waiting=!0,void this.common.axios.post("./admin/ajax/save",{G_CONFIG:{admin_username:e.g_config.admin_username,admin_password:e.g_config.admin_password,admin_password_old:e.g_config.admin_password_old}}).then((function(a){e.waiting=!1,t.common.axios.get("./admin/public/logout").catch((function(){})),alert(a.data.info),t.$store.commit("logoutSuccess"),t.$router.push({path:"/login"})})).catch((function(t){e.waiting=!1,console.log(t),e.$message(t.response&&t.response.data.info?t.response.data.info:t.message,"d")}))):e.$message("用户名或密码为空","w")}}},le=re,ce=Object(O["a"])(le,ne,se,!1,null,null,null),de=ce.exports,ue=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("b-card",{attrs:{"no-body":""}},[a("b-card-header",[t._v("开发者设置")]),a("b-card-body",[a("div",{staticClass:"my-3"},[a("b-button",{staticStyle:{"min-width":"80px"},attrs:{href:"#",variant:"primary"},on:{click:function(e){t.editable=!t.editable}}},[t._v(t._s(t.editable?"取消":"编辑"))]),a("b-button",{staticClass:"mx-3",staticStyle:{"min-width":"80px"},attrs:{href:"#",variant:"danger",disabled:!t.editable},on:{click:t.saveConfig}},[t._v("保存")]),a("p",{staticClass:"d-inline"},[t._v("谨慎使用，除非你知道到底在做什么")])],1),a("b-form-textarea",{attrs:{id:"textarea",placeholder:"Enter something...",rows:"50",disabled:!t.editable},model:{value:t.config,callback:function(e){t.config=e},expression:"config"}})],1)],1)},pe=[],me={data:function(){return{config:"default info",admin_password_old:"",editable:!1}},created:function(){var t=this;this.$prompt({message:"为保护关键信息，请输入管理员密码。（密码验证成功后，所有配置信息将以明文显示）",title:"安全验证",cancelTitle:"取消",okTitle:"确定",ok:function(e){t.common.axios.post("./admin/ajax/setting/config",{password:e}).then((function(a){console.log(a.data),t.admin_password_old=e,t.config=JSON.stringify(a.data,null,2)})).catch((function(e){t.config=JSON.stringify(e)}))},cancel:function(){t.config="验证取消"},close:function(){t.config="验证取消"}})},methods:{saveConfig:function(){var t;try{if(t=JSON.parse(this.config),!t.G_CONFIG||!t.DRIVE_MAP)return alert("invalid config")}catch(e){return alert("invalid json")}t.G_CONFIG.admin_password_old=this.admin_password_old,this.common.axios.post("./admin/ajax/save",t).then((function(t){alert(t.data.info)})).catch((function(t){console.log(t),alert("failed")}))}}},fe=me,he=Object(O["a"])(fe,ue,pe,!1,null,null,null),ge=he.exports;o["default"].use(Y["a"]);var ve=[{path:"/dashboard",name:"Dashboard",component:$t},{path:"/files",name:"Files",component:Ft},{path:"/cache",name:"Cache",component:Lt},{path:"/setting*",component:Wt,children:[{path:"site",component:Xt},{path:"drives",component:ie},{path:"password",component:de},{path:"dev",component:ge}]},{path:"/home*",name:"Home",component:gt},{path:"/login",name:"Login",component:yt},{path:"/*",name:"Home1",component:gt}],be=new Y["a"]({routes:ve}),_e=be,we=a("2f62");o["default"].use(we["a"]);var xe=new we["a"].Store({state:{isadmin:!1},mutations:{loginSuccess:function(t){t.isadmin=!0},logoutSuccess:function(t){window.localStorage.removeItem("loginTime"),t.isadmin=!1}},actions:{},modules:{}}),ye=(a("b680"),a("bc3a")),De=a.n(ye),ke={p_h0:window.p_h0,axios:De.a.create({baseURL:window.p_h0+"/",withCredentials:!0}),formatDate:function(t){var e=new Date(t);if("Invalid Date"==e)return e;var a=e.getFullYear(),o=e.getMonth()<9?"0"+(e.getMonth()+1):e.getMonth()+1,i=e.getDate()<10?"0"+e.getDate():e.getDate(),n=e.getHours()<10?"0"+e.getHours():e.getHours(),s=e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes(),r=e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds(),l=a+"-"+o+"-"+i+" "+n+":"+s+":"+r;return l},formatSize:function(t){"number"!==typeof t&&(t=NaN);var e=0;while(t>=1024)t/=1024,e++;return t=t.toFixed(2),t+=[" B"," KB"," MB"," GB"][e],t},urlSpCharEncode:function(t){if(!t)return t;for(var e="",a=t.length,o=0;o<a;o++){var i=t[o];switch(i){case"%":e+="%25";break;case"?":e+="%3f";break;case"#":e+="%23";break;case" ":e+="%20";break;default:e+=i}}return e}},Ce=ke;o["default"].config.productionTip=!1,o["default"].prototype.common=Ce;var Pe=new o["default"]({router:_e,store:xe,render:function(t){return t(K)}}).$mount("#app");o["default"].prototype.$message=function(t,e,a){e={i:"info",d:"danger",s:"success",w:"warning"}[e]||"primary",Pe.$bvToast.toast(t,{title:a||e,variant:e,solid:!0})},console.log("200322 测试版本,如果发现问题请到 github 反馈"),console.log("github: https://github.com/ukuq/onepoint")},a66a:function(t,e,a){},f50a:function(t,e,a){"use strict";var o=a("a66a"),i=a.n(o);i.a}});
//# sourceMappingURL=app.397e5da4.js.map